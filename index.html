
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ó‡∏µ‡∏°‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏™‡∏≠‡∏ö‡∏™‡∏ß‡∏ô‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡πá‡∏ß ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£</title>
    <link href="https://fonts.googleapis.com/css2?family=Anuphan:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- SheetJS library for Excel import -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
        import { getDatabase, ref, set, get, child, push, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyBeCKoVceDGwX0EA3IEPEsmGULkzm3ddnE",
            authDomain: "bmasrrt.firebaseapp.com",
            databaseURL: "https://bmasrrt-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "bmasrrt",
            storageBucket: "bmasrrt.firebasestorage.app",
            messagingSenderId: "91632560633",
            appId: "1:91632560633:web:313015041e20d883dc7528",
            measurementId: "G-N4FC1EJRHJ"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const database = getDatabase(app);
        const auth = getAuth(app);

        // Make Firebase services available globally
        window.firebaseApp = app;
        window.firebaseDatabase = database;
        window.firebaseAuth = auth;
        window.firebaseRef = ref;
        window.firebaseSet = set;
        window.firebaseGet = get;
        window.firebaseChild = child;
        window.firebasePush = push;
        window.firebaseUpdate = update;
        window.firebaseRemove = remove;
        window.firebaseSignInWithEmailAndPassword = signInWithEmailAndPassword;
        window.firebaseCreateUserWithEmailAndPassword = createUserWithEmailAndPassword;
        window.firebaseSignOut = signOut;
    </script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'anuphan': ['Anuphan', 'sans-serif']
                    },
                    colors: {
                        'dark-green': '#1e3a2e',
                        'medium-green': '#2d5a3d',
                        'light-green': '#4a7c59'
                    }
                }
            }
        }
    </script>
</head>
<body class="font-anuphan bg-gray-100 min-h-screen">
    <!-- Login Page -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-dark-green to-medium-green">
        <div class="bg-white p-8 rounded-lg shadow-2xl w-full max-w-md">
            <div class="text-center mb-8">
                <h1 class="text-2xl font-bold text-dark-green mb-2">‡∏ó‡∏µ‡∏°‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏™‡∏≠‡∏ö‡∏™‡∏ß‡∏ô‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡πá‡∏ß</h1>
                <p class="text-gray-600">‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£</p>
            </div>
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label>
                    <input type="text" id="username" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                    <input type="password" id="password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                </div>
                <button type="submit" id="loginBtn" class="w-full bg-medium-green text-white py-2 px-4 rounded-md hover:bg-dark-green transition duration-200">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            </form>
            
            <!-- Register Form -->
            <form id="registerForm" class="space-y-6 hidden">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label>
                    <input type="text" id="regUsername" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                    <input type="password" id="regPassword" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                    <input type="password" id="regConfirmPassword" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                    <input type="text" id="regFullName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</label>
                    <select id="regRole" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</option>
                        <option value="officer">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</option>
                        <option value="admin">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</label>
                    <input type="text" id="regOrgId" placeholder="‡πÄ‡∏ä‡πà‡∏ô BMA001, BMA002" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                </div>
                <button type="submit" id="registerBtn" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-200">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
            </form>
            
            <div id="loginError" class="mt-4 text-red-600 text-sm text-center hidden"></div>
            
            <!-- Toggle between Login and Register -->
            <div class="mt-6 text-center">
                <button id="toggleToRegister" class="text-medium-green hover:text-dark-green text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</button>
                <button id="toggleToLogin" class="text-medium-green hover:text-dark-green text-sm hidden">‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß? ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
            
            <!-- Firebase Connection Status -->
            <div id="connectionStatus" class="mt-4 text-xs text-center">
                <span class="text-gray-500">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</span>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hidden">
        <!-- Navigation -->
        <nav class="bg-dark-green text-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-4">
                        <h1 class="text-xl font-bold">‡∏ó‡∏µ‡∏°‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏™‡∏≠‡∏ö‡∏™‡∏ß‡∏ô‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡πá‡∏ß ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span id="currentUser" class="text-sm"></span>
                        <button id="logoutBtn" class="bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-sm">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
                    </div>
                </div>
                <div class="flex space-x-1 pb-4" id="navTabs">
                    <!-- Navigation tabs will be populated by JavaScript -->
                </div>
            </div>
        </nav>

        <!-- Content Area -->
        <div class="max-w-7xl mx-auto px-4 py-6">
            <!-- Officer Dashboard -->
            <div id="officerDashboard" class="tab-content hidden">
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <h2 class="text-xl font-bold text-dark-green mb-6">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡∏° SRRT</h2>
                    <!-- Search and Filter Section -->
                    <div class="mb-6 bg-gray-50 p-4 rounded-lg">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                                <input type="text" id="officerSearch" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠ ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà ‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô..." class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" onkeyup="searchOfficers()">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</label>
                                <select id="orgFilter" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" onchange="filterOfficers()">
                                    <option value="">‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°</label>
                                <select id="trainingFilter" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" onchange="filterOfficers()">
                                    <option value="">‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
                                    <option value="trained">‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°‡πÅ‡∏•‡πâ‡∏ß</option>
                                    <option value="not-trained">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <!-- Organization blocks will be populated by JavaScript -->
                </div>
            </div>

            <!-- Team Management -->
            <div id="teamManagement" class="tab-content hidden">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h2 class="text-xl font-bold text-dark-green mb-4">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏°</h2>
                    
                    <!-- Team Summary Section -->
                    <div class="bg-gradient-to-r from-blue-50 to-green-50 rounded-lg p-6 mb-6">
                        <h3 class="text-lg font-bold text-dark-green mb-4">‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏°</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-white rounded-lg p-4 shadow-sm">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-600 text-sm">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                                        <p class="text-2xl font-bold text-blue-600" id="teamTotalMembers">-</p>
                                        <p class="text-gray-500 text-sm">‡∏Ñ‡∏ô</p>
                                    </div>
                                    <div class="text-3xl opacity-70">üë•</div>
                                </div>
                            </div>
                            <div class="bg-white rounded-lg p-4 shadow-sm">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-600 text-sm">‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°‡πÅ‡∏•‡πâ‡∏ß</p>
                                        <p class="text-2xl font-bold text-green-600" id="teamTrainedMembers">-</p>
                                        <p class="text-gray-500 text-sm">‡∏Ñ‡∏ô</p>
                                    </div>
                                    <div class="text-3xl opacity-70">‚úÖ</div>
                                </div>
                            </div>
                            <div class="bg-white rounded-lg p-4 shadow-sm">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-600 text-sm">‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°</p>
                                        <p class="text-2xl font-bold text-purple-600" id="teamTrainingPercentage">-</p>
                                        <p class="text-gray-500 text-sm">%</p>
                                    </div>
                                    <div class="text-3xl opacity-70">üìä</div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm text-gray-600">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°</span>
                                <span class="text-sm font-medium text-gray-700" id="teamProgressText">-</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div class="bg-gradient-to-r from-green-400 to-green-600 h-3 rounded-full transition-all duration-500" id="teamProgressBar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</label>
                            <p class="text-lg font-semibold text-dark-green">BMA001</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</label>
                            <p class="text-lg font-semibold text-dark-green">‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏Ç‡∏ï‡∏ö‡∏≤‡∏á‡∏£‡∏±‡∏Å</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                            <input type="text" id="editPhone" value="02-234-5678" class="w-full px-3 py-1 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">‡πÇ‡∏ó‡∏£‡∏™‡∏≤‡∏£</label>
                            <input type="text" id="editFax" value="02-234-5679" class="w-full px-3 py-1 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                            <input type="email" id="editEmail" value="bangrak@bma.go.th" class="w-full px-3 py-1 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green">
                        </div>
                    </div>
                    <button onclick="saveOrgInfo()" class="bg-medium-green text-white px-4 py-2 rounded hover:bg-dark-green mb-6">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</button>
                    
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-dark-green">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏ô‡∏ó‡∏µ‡∏°</h3>
                        <button onclick="showAddMemberModal()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà</button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white border border-gray-200">
                            <thead class="bg-medium-green text-white">
                                <tr>
                                    <th class="px-4 py-2 text-left">‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</th>
                                    <th class="px-4 py-2 text-left">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
                                    <th class="px-4 py-2 text-left">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th>
                                    <th class="px-4 py-2 text-left">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</th>
                                    <th class="px-4 py-2 text-left">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                                    <th class="px-4 py-2 text-center">‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°</th>
                                    <th class="px-4 py-2 text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody id="teamTableBody">
                                <!-- Team members will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Confirmation Section -->
                    <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="text-lg font-semibold text-dark-green">‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h4>
                                <p class="text-sm text-gray-600 mt-1">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏°‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</p>
                            </div>
                            <div class="flex space-x-3">
                                <div class="text-center">
                                    <div class="text-sm text-gray-600">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏°:</div>
                                    <span id="teamConfirmStatus" class="inline-block px-3 py-1 rounded text-sm font-medium">-</span>
                                </div>
                                <div class="text-center">
                                    <div class="text-sm text-gray-600">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô:</div>
                                    <span id="orgConfirmStatus" class="inline-block px-3 py-1 rounded text-sm font-medium">-</span>
                                </div>
                                <button id="confirmTeamDataBtn" onclick="confirmTeamData()" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed">
                                    ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>



            <!-- Admin - Summary Report -->
            <div id="summaryReport" class="tab-content hidden">
                <div class="space-y-6">
                    <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏µ‡∏° SRRT ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£ -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h2 class="text-xl font-bold text-dark-green mb-6">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏µ‡∏° SRRT ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-blue-100 text-sm">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡∏°</p>
                                        <p class="text-3xl font-bold" id="totalTeams">-</p>
                                        <p class="text-blue-100 text-sm">‡∏ó‡∏µ‡∏°</p>
                                    </div>
                                    <div class="text-4xl opacity-80">üè¢</div>
                                </div>
                            </div>
                            <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-green-100 text-sm">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</p>
                                        <p class="text-3xl font-bold" id="totalOfficers">-</p>
                                        <p class="text-green-100 text-sm">‡∏Ñ‡∏ô</p>
                                    </div>
                                    <div class="text-4xl opacity-80">üë•</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h2 class="text-xl font-bold text-dark-green mb-6">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</h2>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200">
                                <thead class="bg-medium-green text-white">
                                    <tr>
                                        <th class="px-4 py-2 text-left">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th>
                                        <th class="px-4 py-2 text-center">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏ô‡∏ó‡∏µ‡∏°</th>
                                        <th class="px-4 py-2 text-center">‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°‡πÅ‡∏•‡πâ‡∏ß</th>
                                        <th class="px-4 py-2 text-center">‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°</th>
                                    </tr>
                                </thead>
                                <tbody id="orgSummaryTableBody">
                                    <!-- Organization summary will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin - All Officers Database -->
            <div id="allOfficersDB" class="tab-content hidden">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-dark-green">‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</h2>
                        <div class="flex space-x-2">
                            <button onclick="showImportOfficersModal()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏≤‡∏Å Excel</button>
                            <button onclick="showAddOfficerModal()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏°‡πà</button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white border border-gray-200">
                            <thead class="bg-medium-green text-white">
                                <tr>
                                    <th class="px-4 py-2 text-left">‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</th>
                                    <th class="px-4 py-2 text-left">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
                                    <th class="px-4 py-2 text-left">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th>
                                    <th class="px-4 py-2 text-left">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</th>
                                    <th class="px-4 py-2 text-left">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                                    <th class="px-4 py-2 text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</th>
                                    <th class="px-4 py-2 text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody id="allOfficersTableBody">
                                <!-- All officers will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Admin - Training Database -->
            <div id="trainingDB" class="tab-content hidden">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-dark-green">‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°</h2>
                        <div class="flex space-x-2">
                            <button onclick="showAddYearModal()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏µ</button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white border border-gray-200">
                            <thead class="bg-medium-green text-white">
                                <tr>
                                    <th class="px-4 py-2 text-left">‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</th>
                                    <th class="px-4 py-2 text-left">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
                                    <th class="px-4 py-2 text-left">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th>
                                    <th class="px-4 py-2 text-center">2023</th>
                                    <th class="px-4 py-2 text-center">2024</th>
                                </tr>
                            </thead>
                            <tbody id="trainingTableBody">
                                <!-- Training data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Admin - Organizations Database -->
            <div id="organizationsDB" class="tab-content hidden">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-dark-green">‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</h2>
                        <div class="flex space-x-2">
                            <button onclick="showImportOrganizationsModal()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏≤‡∏Å Excel</button>
                            <button onclick="showAddOrgModal()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white border border-gray-200">
                            <thead class="bg-medium-green text-white">
                                <tr>
                                    <th class="px-4 py-2 text-left">‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th>
                                    <th class="px-4 py-2 text-left">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th>
                                    <th class="px-4 py-2 text-left">‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</th>
                                    <th class="px-4 py-2 text-left">‡πÇ‡∏ó‡∏£‡∏™‡∏≤‡∏£</th>
                                    <th class="px-4 py-2 text-left">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                                    <th class="px-4 py-2 text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</th>
                                    <th class="px-4 py-2 text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody id="organizationsTableBody">
                                <!-- Organizations will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Admin - User Accounts -->
            <div id="userAccounts" class="tab-content hidden">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-dark-green">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h2>
                        <button onclick="showAddUserModal()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà</button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white border border-gray-200">
                            <thead class="bg-medium-green text-white">
                                <tr>
                                    <th class="px-4 py-2 text-left">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                    <th class="px-4 py-2 text-left">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th>
                                    <th class="px-4 py-2 text-left">Username</th>
                                    <th class="px-4 py-2 text-left">Password</th>
                                    <th class="px-4 py-2 text-left">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á</th>
                                    <th class="px-4 py-2 text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody id="userAccountsTableBody">
                                <!-- User accounts will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Admin - Activity Log -->
            <div id="activityLog" class="tab-content hidden">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h2 class="text-xl font-bold text-dark-green mb-6">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white border border-gray-200">
                            <thead class="bg-medium-green text-white">
                                <tr>
                                    <th class="px-4 py-2 text-left">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                    <th class="px-4 py-2 text-left">‡πÄ‡∏ß‡∏•‡∏≤</th>
                                    <th class="px-4 py-2 text-left">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</th>
                                    <th class="px-4 py-2 text-left">‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥</th>
                                    <th class="px-4 py-2 text-left">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                                    <th class="px-4 py-2 text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                </tr>
                            </thead>
                            <tbody id="activityLogTableBody">
                                <!-- Activity log will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="modalOverlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div id="modalContent" class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Sample data
        let currentUser = null;
        let userRole = null;
        
        const users = [];

        const organizations = [];

        const officers = [];

        const trainingData = {};

        const activityLog = [];

        // Confirmation status for each organization
        const confirmationStatus = {};

        // Firebase functions
        async function initializeFirebaseData() {
            try {
                console.log('Initializing Firebase data...');
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Firebase ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                const usersSnapshot = await window.firebaseGet(window.firebaseRef(window.firebaseDatabase, 'users'));
                const existingUsers = usersSnapshot.val();
                
                if (!existingUsers || (Array.isArray(existingUsers) && existingUsers.length === 0) || Object.keys(existingUsers).length === 0) {
                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏£‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                    const defaultUser = { 
                        username: 'admin', 
                        password: 'admin123', 
                        name: '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö', 
                        role: 'admin', 
                        orgId: 'ADMIN',
                        createdAt: new Date().toISOString()
                    };
                    
                    // ‡πÉ‡∏ä‡πâ push() ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á unique key
                    const userRef = window.firebasePush(window.firebaseRef(window.firebaseDatabase, 'users'));
                    await window.firebaseSet(userRef, defaultUser);
                    await window.firebaseSet(window.firebaseRef(window.firebaseDatabase, 'organizations'), organizations);
                    await window.firebaseSet(window.firebaseRef(window.firebaseDatabase, 'officers'), officers);
                    await window.firebaseSet(window.firebaseRef(window.firebaseDatabase, 'trainingData'), trainingData);
                    await window.firebaseSet(window.firebaseRef(window.firebaseDatabase, 'activityLog'), activityLog);
                    await window.firebaseSet(window.firebaseRef(window.firebaseDatabase, 'confirmationStatus'), confirmationStatus);
                    
                    console.log('Default admin user created in Firebase');
                } else {
                    console.log('Data already exists in Firebase');
                }
                
                // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase
                await loadDataFromFirebase();
                
            } catch (error) {
                console.error('Error initializing Firebase data:', error);
            }
        }
        
        async function loadDataFromFirebase() {
            try {
                console.log('Starting to load data from Firebase...');
                
                // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å Firebase
                const [usersSnap, orgsSnap, officersSnap, trainingSnap, activitySnap, confirmSnap] = await Promise.all([
                    window.firebaseGet(window.firebaseRef(window.firebaseDatabase, 'users')),
                    window.firebaseGet(window.firebaseRef(window.firebaseDatabase, 'organizations')),
                    window.firebaseGet(window.firebaseRef(window.firebaseDatabase, 'officers')),
                    window.firebaseGet(window.firebaseRef(window.firebaseDatabase, 'trainingData')),
                    window.firebaseGet(window.firebaseRef(window.firebaseDatabase, 'activityLog')),
                    window.firebaseGet(window.firebaseRef(window.firebaseDatabase, 'confirmationStatus'))
                ]);
                
                console.log('Firebase snapshots received');
                
                // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï local arrays ‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase
                if (usersSnap.val()) {
                    users.length = 0;
                    const firebaseUsers = usersSnap.val();
                    if (Array.isArray(firebaseUsers)) {
                        users.push(...firebaseUsers);
                    } else {
                        // Firebase ‡∏Ñ‡∏∑‡∏ô Object, ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô Array
                        const userArray = Object.values(firebaseUsers);
                        users.push(...userArray);
                    }
                    console.log('Loaded users from Firebase:', users.length, 'users');
                }
                
                if (orgsSnap.val()) {
                    organizations.length = 0;
                    const firebaseOrgs = orgsSnap.val();
                    if (Array.isArray(firebaseOrgs)) {
                        organizations.push(...firebaseOrgs);
                    } else {
                        const orgArray = Object.values(firebaseOrgs);
                        organizations.push(...orgArray);
                    }
                    console.log('Loaded organizations from Firebase:', organizations.length, 'organizations');
                }
                
                if (officersSnap.val()) {
                    officers.length = 0;
                    const firebaseOfficers = officersSnap.val();
                    if (Array.isArray(firebaseOfficers)) {
                        officers.push(...firebaseOfficers);
                    } else {
                        const officerArray = Object.values(firebaseOfficers);
                        officers.push(...officerArray);
                    }
                    console.log('Loaded officers from Firebase:', officers.length, 'officers');
                }
                
                if (trainingSnap.val()) {
                    // ‡∏•‡πâ‡∏≤‡∏á trainingData ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏≠‡∏≤‡πÉ‡∏´‡∏°‡πà
                    Object.keys(trainingData).forEach(key => delete trainingData[key]);
                    Object.assign(trainingData, trainingSnap.val());
                    console.log('Loaded training data from Firebase');
                }
                
                if (activitySnap.val()) {
                    activityLog.length = 0;
                    const firebaseActivity = activitySnap.val();
                    if (Array.isArray(firebaseActivity)) {
                        activityLog.push(...firebaseActivity);
                    } else {
                        const activityArray = Object.values(firebaseActivity);
                        activityLog.push(...activityArray);
                    }
                    console.log('Loaded activity log from Firebase:', activityLog.length, 'entries');
                }
                
                if (confirmSnap.val()) {
                    // ‡∏•‡πâ‡∏≤‡∏á confirmationStatus ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏≠‡∏≤‡πÉ‡∏´‡∏°‡πà
                    Object.keys(confirmationStatus).forEach(key => delete confirmationStatus[key]);
                    Object.assign(confirmationStatus, confirmSnap.val());
                    console.log('Loaded confirmation status from Firebase');
                }
                
                console.log('All data loaded from Firebase successfully');
                console.log('Final data counts:', {
                    users: users.length,
                    organizations: organizations.length,
                    officers: officers.length,
                    trainingData: Object.keys(trainingData).length,
                    activityLog: activityLog.length,
                    confirmationStatus: Object.keys(confirmationStatus).length
                });
                
            } catch (error) {
                console.error('Error loading data from Firebase:', error);
                throw error;
            }
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        async function refreshAllData() {
            console.log('Refreshing all UI data...');
            try {
                // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä dropdown ‡∏ï‡πà‡∏≤‡∏á‡πÜ
                populateOrganizationDropdowns();
                
                // ‡∏à‡∏∞‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å tab ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
                console.log('Data refresh completed');
            } catch (error) {
                console.error('Error refreshing data:', error);
            }
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏ô dropdown ‡∏ï‡πà‡∏≤‡∏á‡πÜ
        function populateOrganizationDropdowns() {
            const selectors = [
                '#officerOrgFilter',
                '#regOrgId'
            ];
            
            selectors.forEach(selector => {
                const element = document.querySelector(selector);
                if (element) {
                    // ‡πÄ‡∏Å‡πá‡∏ö option ‡πÅ‡∏£‡∏Å‡πÑ‡∏ß‡πâ
                    const firstOption = element.querySelector('option:first-child');
                    element.innerHTML = '';
                    if (firstOption) {
                        element.appendChild(firstOption);
                    }
                    
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏° option ‡πÉ‡∏´‡∏°‡πà
                    organizations.forEach(org => {
                        const option = document.createElement('option');
                        option.value = org.id;
                        option.textContent = org.name;
                        element.appendChild(option);
                    });
                }
            });
        }
        
        async function saveToFirebase(path, data) {
            try {
                console.log(`Attempting to save to Firebase path: ${path}`, data);
                await window.firebaseSet(window.firebaseRef(window.firebaseDatabase, path), data);
                console.log(`Data saved to Firebase successfully: ${path}`);
                return true;
            } catch (error) {
                console.error(`Error saving to Firebase (${path}):`, error);
                console.error('Error details:', error.message);
                throw error;
            }
        }

        // Helper functions
        function showError(message) {
            document.getElementById('loginError').textContent = message;
            document.getElementById('loginError').classList.remove('hidden');
        }
        
        function clearError() {
            document.getElementById('loginError').classList.add('hidden');
        }
        
        function resetButton(button, originalText) {
            button.textContent = originalText;
            button.disabled = false;
        }

        // Toggle between login and register forms
        document.getElementById('toggleToRegister').addEventListener('click', function() {
            clearError();
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
            document.getElementById('toggleToRegister').classList.add('hidden');
            document.getElementById('toggleToLogin').classList.remove('hidden');
            document.getElementById('loginError').classList.add('hidden');
        });
        
        document.getElementById('toggleToLogin').addEventListener('click', function() {
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('toggleToLogin').classList.add('hidden');
            document.getElementById('toggleToRegister').classList.remove('hidden');
            clearError();
        });

        // Register functionality
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Show loading state
            const registerBtn = document.getElementById('registerBtn');
            const originalText = registerBtn.textContent;
            registerBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô...';
            registerBtn.disabled = true;
            
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;
            const fullName = document.getElementById('regFullName').value.trim();
            const role = document.getElementById('regRole').value;
            const orgId = document.getElementById('regOrgId').value.trim().toUpperCase();
            
            // Clear previous errors
            document.getElementById('loginError').classList.add('hidden');
            
            // Enhanced Validation
            if (!username || !password || !fullName || !role || !orgId) {
                showError('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                resetButton(registerBtn, originalText);
                return;
            }
            
            if (username.length < 3) {
                showError('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 3 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£');
                resetButton(registerBtn, originalText);
                return;
            }
            
            if (password !== confirmPassword) {
                showError('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô');
                resetButton(registerBtn, originalText);
                return;
            }
            
            if (password.length < 6) {
                showError('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£');
                resetButton(registerBtn, originalText);
                return;
            }
            
            try {
                // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å Firebase
                await loadDataFromFirebase();
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ username ‡∏ã‡πâ‡∏≥‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                const existingUser = users.find(u => u.username === username);
                if (existingUser) {
                    document.getElementById('loginError').textContent = '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Ñ‡∏ô‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß';
                    document.getElementById('loginError').classList.remove('hidden');
                    return;
                }
                
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà
                const newUser = {
                    username: username,
                    password: password,
                    name: fullName,
                    role: role,
                    orgId: orgId,
                    createdAt: new Date().toISOString()
                };
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô local array
                users.push(newUser);
                
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Firebase ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ push() ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á unique key
                const userRef = window.firebasePush(window.firebaseRef(window.firebaseDatabase, 'users'));
                await window.firebaseSet(userRef, newUser);
                
                console.log('User registered and saved to Firebase:', newUser);
                
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á confirmation status ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
                if (role === 'officer' && !confirmationStatus[orgId]) {
                    confirmationStatus[orgId] = { teamConfirmed: false, orgConfirmed: false };
                    await saveToFirebase('confirmationStatus', confirmationStatus);
                }
                
                await logActivity('‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô', `‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô: ${fullName} (${username})`);
                
                alert('‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß');
                
                // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ login
                document.getElementById('registerForm').classList.add('hidden');
                document.getElementById('loginForm').classList.remove('hidden');
                document.getElementById('toggleToLogin').classList.add('hidden');
                document.getElementById('toggleToRegister').classList.remove('hidden');
                
                // ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
                document.getElementById('registerForm').reset();
                
            } catch (error) {
                console.error('Registration error:', error);
                if (error.message && error.message.includes('permission')) {
                    showError('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase');
                } else {
                    showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô');
                }
            } finally {
                resetButton(registerBtn, originalText);
            }
        });

        // Helper functions
        function showError(message) {
            document.getElementById('loginError').textContent = message;
            document.getElementById('loginError').classList.remove('hidden');
        }
        
        function clearError() {
            document.getElementById('loginError').classList.add('hidden');
        }
        
        function resetButton(button, originalText) {
            button.textContent = originalText;
            button.disabled = false;
        }

        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Show loading state
            const loginBtn = document.getElementById('loginBtn');
            const originalText = loginBtn.textContent;
            loginBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...';
            loginBtn.disabled = true;
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            
            // Clear previous errors
            document.getElementById('loginError').classList.add('hidden');
            
            try {
                // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å Firebase
                console.log('Loading data from Firebase...');
                await loadDataFromFirebase();
                console.log('Data loaded. Current data:', {
                    users: users.length,
                    organizations: organizations.length,
                    officers: officers.length
                });
                
                const user = users.find(u => u.username === username && u.password === password);
                
                if (user) {
                    currentUser = user;
                    userRole = user.role;
                    document.getElementById('loginPage').classList.add('hidden');
                    document.getElementById('mainApp').classList.remove('hidden');
                    document.getElementById('currentUser').textContent = user.name;
                    setupNavigation();
                    
                    // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏™‡∏î‡∏á
                    await refreshAllData();
                    
                    showDefaultTab();
                    await logActivity('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö', '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                } else {
                    showError('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                }
            } catch (error) {
                console.error('Login error:', error);
                showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö');
            } finally {
                resetButton(loginBtn, originalText);
            }
        });

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', function() {
            logActivity('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö', '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö');
            currentUser = null;
            userRole = null;
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('loginError').classList.add('hidden');
        });

        // Setup navigation based on user role
        function setupNavigation() {
            const navTabs = document.getElementById('navTabs');
            navTabs.innerHTML = '';
            
            if (userRole === 'officer') {
                navTabs.innerHTML = `
                    <button onclick="showTab('officerDashboard')" class="nav-tab px-4 py-2 text-white hover:bg-medium-green rounded">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡∏° SRRT</button>
                    <button onclick="showTab('teamManagement')" class="nav-tab px-4 py-2 text-white hover:bg-medium-green rounded">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏°</button>
                `;
            } else if (userRole === 'admin') {
                navTabs.innerHTML = `
                    <button onclick="showTab('summaryReport')" class="nav-tab px-4 py-2 text-white hover:bg-medium-green rounded">‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    <button onclick="showTab('allOfficersDB')" class="nav-tab px-4 py-2 text-white hover:bg-medium-green rounded">‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</button>
                    <button onclick="showTab('trainingDB')" class="nav-tab px-4 py-2 text-white hover:bg-medium-green rounded">‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°</button>
                    <button onclick="showTab('organizationsDB')" class="nav-tab px-4 py-2 text-white hover:bg-medium-green rounded">‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</button>
                    <button onclick="showTab('userAccounts')" class="nav-tab px-4 py-2 text-white hover:bg-medium-green rounded">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
                    <button onclick="showTab('activityLog')" class="nav-tab px-4 py-2 text-white hover:bg-medium-green rounded">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                `;
            }
        }

        // Show tab functionality
        function showTab(tabId) {
            console.log('Switching to tab:', tabId);
            
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Remove active class from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('bg-medium-green');
            });
            
            // Show selected tab
            const targetTab = document.getElementById(tabId);
            if (targetTab) {
                targetTab.classList.remove('hidden');
            } else {
                console.error('Tab not found:', tabId);
                return;
            }
            
            // Add active class to clicked nav tab (if event exists)
            if (typeof event !== 'undefined' && event.target) {
                event.target.classList.add('bg-medium-green');
            } else {
                // Find and activate the correct nav tab
                const navButtons = document.querySelectorAll('.nav-tab');
                navButtons.forEach(button => {
                    if (button.onclick && button.onclick.toString().includes(tabId)) {
                        button.classList.add('bg-medium-green');
                    }
                });
            }
            
            // Load data for the tab
            loadTabData(tabId);
        }

        // Show default tab based on user role
        function showDefaultTab() {
            console.log('Showing default tab for role:', userRole);
            if (userRole === 'officer') {
                showTab('officerDashboard');
            } else if (userRole === 'admin') {
                showTab('summaryReport');
            }
        }

        // Load data for specific tabs
        function loadTabData(tabId) {
            console.log('Loading data for tab:', tabId);
            switch(tabId) {
                case 'summaryReport':
                    loadSummaryReportData();
                    break;
                case 'officerDashboard':
                    loadOfficerDashboardData();
                    break;
                case 'teamManagement':
                    loadTeamData();
                    break;
                case 'allOfficersDB':
                    loadAllOfficersData();
                    break;
                case 'trainingDB':
                    loadTrainingData();
                    break;
                case 'organizationsDB':
                    loadOrganizationsData();
                    break;
                case 'userAccounts':
                    loadUserAccountsData();
                    break;
                case 'activityLog':
                    loadActivityLogData();
                    break;
            }
        }

        // Load summary report data
        function loadSummaryReportData() {
            console.log('Loading summary report data...');
            console.log('Organizations:', organizations.length);
            console.log('Officers:', officers.length);
            
            // ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏µ‡∏° SRRT ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£
            const totalTeams = organizations.length;
            const totalOfficers = officers.length;
            
            const totalTeamsElement = document.getElementById('totalTeams');
            const totalOfficersElement = document.getElementById('totalOfficers');
            
            if (totalTeamsElement) {
                totalTeamsElement.textContent = totalTeams;
            } else {
                console.error('totalTeams element not found');
            }
            
            if (totalOfficersElement) {
                totalOfficersElement.textContent = totalOfficers;
            } else {
                console.error('totalOfficers element not found');
            }
            
            // ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
            const tbody = document.getElementById('orgSummaryTableBody');
            if (!tbody) {
                console.error('orgSummaryTableBody element not found');
                return;
            }
            
            console.log('Populating summary table with', organizations.length, 'organizations');
            
            if (organizations.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="px-4 py-8 text-center text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</td></tr>';
                return;
            }
            
            tbody.innerHTML = organizations.map(org => {
                const orgOfficers = officers.filter(officer => officer.orgId === org.id);
                const totalMembers = orgOfficers.length;
                
                // ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏° (‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏ô‡∏õ‡∏µ‡πÉ‡∏î‡∏õ‡∏µ‡∏´‡∏ô‡∏∂‡πà‡∏á)
                let trainedMembers = 0;
                orgOfficers.forEach(officer => {
                    const training = trainingData[officer.id];
                    if (training) {
                        const hasTraining = Object.values(training).some(courses => courses && courses.length > 0);
                        if (hasTraining) {
                            trainedMembers++;
                        }
                    }
                });
                
                const trainingPercentage = totalMembers > 0 ? Math.round((trainedMembers / totalMembers) * 100) : 0;
                
                return `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="px-4 py-2">${org.name}</td>
                        <td class="px-4 py-2 text-center">${totalMembers}</td>
                        <td class="px-4 py-2 text-center">${trainedMembers}</td>
                        <td class="px-4 py-2 text-center">
                            <div class="flex items-center justify-center">
                                <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                    <div class="bg-green-500 h-2 rounded-full" style="width: ${trainingPercentage}%"></div>
                                </div>
                                <span class="text-sm font-medium">${trainingPercentage}%</span>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Load officer dashboard data
        function loadOfficerDashboardData() {
            const container = document.querySelector('#officerDashboard .bg-white');
            
            // Clear existing content except the header and search section
            const header = container.querySelector('h2');
            const searchSection = container.querySelector('.mb-6.bg-gray-50');
            container.innerHTML = '';
            container.appendChild(header);
            
            // Re-add search section if it exists
            if (searchSection) {
                container.appendChild(searchSection);
            } else {
                // Create search section if it doesn't exist
                const searchDiv = document.createElement('div');
                searchDiv.className = 'mb-6 bg-gray-50 p-4 rounded-lg';
                searchDiv.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                            <input type="text" id="officerSearch" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠ ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà ‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô..." class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" onkeyup="searchOfficers()">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</label>
                            <select id="orgFilter" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" onchange="filterOfficers()">
                                <option value="">‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°</label>
                            <select id="trainingFilter" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" onchange="filterOfficers()">
                                <option value="">‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
                                <option value="trained">‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°‡πÅ‡∏•‡πâ‡∏ß</option>
                                <option value="not-trained">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°</option>
                            </select>
                        </div>
                    </div>
                `;
                container.appendChild(searchDiv);
            }
            
            // Populate organization filter dropdown
            const orgFilter = document.getElementById('orgFilter');
            if (orgFilter) {
                const existingOptions = orgFilter.querySelectorAll('option:not([value=""])');
                existingOptions.forEach(option => option.remove());
                
                organizations.forEach(org => {
                    const option = document.createElement('option');
                    option.value = org.id;
                    option.textContent = org.name;
                    orgFilter.appendChild(option);
                });
            }
            
            // Group officers by organization
            const officersByOrg = {};
            officers.forEach(officer => {
                if (!officersByOrg[officer.orgId]) {
                    officersByOrg[officer.orgId] = [];
                }
                officersByOrg[officer.orgId].push(officer);
            });
            
            // Create blocks for each organization
            organizations.forEach(org => {
                if (officersByOrg[org.id] && officersByOrg[org.id].length > 0) {
                    const orgBlock = document.createElement('div');
                    orgBlock.className = 'mb-8';
                    orgBlock.innerHTML = `
                        <div class="bg-medium-green text-white p-4 rounded-t-lg">
                            <h3 class="text-lg font-bold">${org.name}</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-2 text-sm">
                                <div>‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå: ${org.phone}</div>
                                <div>‡πÇ‡∏ó‡∏£‡∏™‡∏≤‡∏£: ${org.fax}</div>
                                <div>‡∏≠‡∏µ‡πÄ‡∏°‡∏•: ${org.email}</div>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="px-4 py-2 text-left">‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</th>
                                        <th class="px-4 py-2 text-left">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
                                        <th class="px-4 py-2 text-left">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</th>
                                        <th class="px-4 py-2 text-left">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${officersByOrg[org.id].map(officer => `
                                        <tr class="border-b hover:bg-gray-50">
                                            <td class="px-4 py-2">${officer.id}</td>
                                            <td class="px-4 py-2">${officer.name}</td>
                                            <td class="px-4 py-2">${officer.phone}</td>
                                            <td class="px-4 py-2">${officer.email}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                    container.appendChild(orgBlock);
                }
            });
        }

        // Load team data
        function loadTeamData() {
            const tbody = document.getElementById('teamTableBody');
            const userOrg = currentUser.orgId;
            const teamMembers = officers.filter(officer => officer.orgId === userOrg);
            const org = organizations.find(o => o.id === userOrg);
            
            // Calculate team summary
            const totalMembers = teamMembers.length;
            let trainedMembers = 0;
            
            teamMembers.forEach(officer => {
                const training = trainingData[officer.id];
                if (training) {
                    const hasTraining = Object.values(training).some(courses => courses && courses.length > 0);
                    if (hasTraining) {
                        trainedMembers++;
                    }
                }
            });
            
            const trainingPercentage = totalMembers > 0 ? Math.round((trainedMembers / totalMembers) * 100) : 0;
            
            // Update summary display
            document.getElementById('teamTotalMembers').textContent = totalMembers;
            document.getElementById('teamTrainedMembers').textContent = trainedMembers;
            document.getElementById('teamTrainingPercentage').textContent = trainingPercentage;
            document.getElementById('teamProgressText').textContent = `${trainedMembers}/${totalMembers} ‡∏Ñ‡∏ô`;
            document.getElementById('teamProgressBar').style.width = `${trainingPercentage}%`;
            
            // Update confirmation status display
            updateConfirmationStatusDisplay();
            
            // Update confirmation status display
            updateConfirmationStatusDisplay();
            
            tbody.innerHTML = teamMembers.map(officer => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="px-4 py-2">${officer.id}</td>
                    <td class="px-4 py-2">${officer.name}</td>
                    <td class="px-4 py-2">${org ? org.name : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</td>
                    <td class="px-4 py-2">${officer.phone}</td>
                    <td class="px-4 py-2">${officer.email}</td>
                    <td class="px-4 py-2 text-center">
                        <button onclick="showOfficerTrainingHistory('${officer.id}')" class="bg-green-500 text-white px-2 py-1 rounded text-sm hover:bg-green-600">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°</button>
                    </td>
                    <td class="px-4 py-2 text-center">
                        <button onclick="editMember('${officer.id}')" class="bg-blue-500 text-white px-2 py-1 rounded text-sm hover:bg-blue-600 mr-1">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button onclick="deleteMember('${officer.id}')" class="bg-red-500 text-white px-2 py-1 rounded text-sm hover:bg-red-600">‡∏•‡∏ö</button>
                    </td>
                </tr>
            `).join('');
        }

        // Load all officers data
        function loadAllOfficersData() {
            console.log('Loading all officers data...');
            const tbody = document.getElementById('allOfficersTableBody');
            if (!tbody) {
                console.error('allOfficersTableBody element not found');
                return;
            }
            
            console.log('Found', officers.length, 'officers to display');
            
            if (officers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="px-4 py-8 text-center text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</td></tr>';
                return;
            }
            
            tbody.innerHTML = officers.map(officer => {
                const org = organizations.find(o => o.id === officer.orgId);
                const confirmStatus = confirmationStatus[officer.orgId];
                let statusDisplay = '';
                let statusAction = '';
                
                if (confirmStatus && confirmStatus.teamConfirmed) {
                    statusDisplay = '<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß</span>';
                    statusAction = `<button onclick="resetTeamConfirmation('${officer.orgId}')" class="bg-orange-500 text-white px-2 py-1 rounded text-xs hover:bg-orange-600 ml-1">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>`;
                } else {
                    statusDisplay = '<span class="bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs">‡∏£‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</span>';
                }
                
                return `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="px-4 py-2">${officer.id}</td>
                        <td class="px-4 py-2">${officer.name}</td>
                        <td class="px-4 py-2">${org ? org.name : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</td>
                        <td class="px-4 py-2">${officer.phone}</td>
                        <td class="px-4 py-2">${officer.email}</td>
                        <td class="px-4 py-2 text-center">
                            ${statusDisplay}
                            ${statusAction}
                        </td>
                        <td class="px-4 py-2 text-center">
                            <button onclick="editOfficer('${officer.id}')" class="bg-blue-500 text-white px-2 py-1 rounded text-sm hover:bg-blue-600 mr-1">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                            <button onclick="deleteOfficer('${officer.id}')" class="bg-red-500 text-white px-2 py-1 rounded text-sm hover:bg-red-600">‡∏•‡∏ö</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Load training data
        function loadTrainingData() {
            const tbody = document.getElementById('trainingTableBody');
            tbody.innerHTML = officers.map(officer => {
                const org = organizations.find(o => o.id === officer.orgId);
                const training2023 = trainingData[officer.id]?.['2023']?.length > 0 ? '‚úì' : '';
                const training2024 = trainingData[officer.id]?.['2024']?.length > 0 ? '‚úì' : '';
                
                return `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="px-4 py-2">${officer.id}</td>
                        <td class="px-4 py-2">${officer.name}</td>
                        <td class="px-4 py-2">${org ? org.name : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</td>
                        <td class="px-4 py-2 text-center cursor-pointer hover:bg-blue-100" onclick="showTrainingModal('${officer.id}', '2023')">${training2023}</td>
                        <td class="px-4 py-2 text-center cursor-pointer hover:bg-blue-100" onclick="showTrainingModal('${officer.id}', '2024')">${training2024}</td>
                    </tr>
                `;
            }).join('');
        }

        // Load organizations data
        function loadOrganizationsData() {
            console.log('Loading organizations data...');
            const tbody = document.getElementById('organizationsTableBody');
            if (!tbody) {
                console.error('organizationsTableBody element not found');
                return;
            }
            
            console.log('Found', organizations.length, 'organizations to display');
            
            if (organizations.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="px-4 py-8 text-center text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</td></tr>';
                return;
            }
            
            tbody.innerHTML = organizations.map(org => {
                const confirmStatus = confirmationStatus[org.id];
                let statusDisplay = '';
                let statusAction = '';
                
                if (confirmStatus && confirmStatus.orgConfirmed) {
                    statusDisplay = '<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß</span>';
                    statusAction = `<button onclick="resetOrgConfirmation('${org.id}')" class="bg-orange-500 text-white px-2 py-1 rounded text-xs hover:bg-orange-600 ml-1">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>`;
                } else {
                    statusDisplay = '<span class="bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs">‡∏£‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</span>';
                }
                
                return `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="px-4 py-2">${org.id}</td>
                        <td class="px-4 py-2">${org.name}</td>
                        <td class="px-4 py-2">${org.phone}</td>
                        <td class="px-4 py-2">${org.fax}</td>
                        <td class="px-4 py-2">${org.email}</td>
                        <td class="px-4 py-2 text-center">
                            ${statusDisplay}
                            ${statusAction}
                        </td>
                        <td class="px-4 py-2 text-center">
                            <button onclick="editOrganization('${org.id}')" class="bg-blue-500 text-white px-2 py-1 rounded text-sm hover:bg-blue-600 mr-1">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                            <button onclick="deleteOrganization('${org.id}')" class="bg-red-500 text-white px-2 py-1 rounded text-sm hover:bg-red-600">‡∏•‡∏ö</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Load user accounts data
        function loadUserAccountsData() {
            console.log('Loading user accounts data...');
            const tbody = document.getElementById('userAccountsTableBody');
            if (!tbody) {
                console.error('userAccountsTableBody element not found');
                return;
            }
            
            console.log('Found', users.length, 'users to display');
            
            if (users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="px-4 py-8 text-center text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</td></tr>';
                return;
            }
            
            tbody.innerHTML = users.map(user => {
                const org = organizations.find(o => o.id === user.orgId);
                return `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="px-4 py-2">${user.name}</td>
                        <td class="px-4 py-2">${org ? org.name : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</td>
                        <td class="px-4 py-2">${user.username}</td>
                        <td class="px-4 py-2">${user.password}</td>
                        <td class="px-4 py-2">${user.role === 'admin' ? '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö' : '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà'}</td>
                        <td class="px-4 py-2 text-center">
                            <button onclick="editUser('${user.username}')" class="bg-blue-500 text-white px-2 py-1 rounded text-sm hover:bg-blue-600 mr-1">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                            <button onclick="deleteUser('${user.username}')" class="bg-red-500 text-white px-2 py-1 rounded text-sm hover:bg-red-600">‡∏•‡∏ö</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Load activity log data
        function loadActivityLogData() {
            const tbody = document.getElementById('activityLogTableBody');
            // Filter only add, edit, delete, confirm, reset actions
            const filteredLog = activityLog.filter(log => 
                log.action === '‡πÄ‡∏û‡∏¥‡πà‡∏°' || log.action === '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç' || log.action === '‡∏•‡∏ö' || log.action === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô' || log.action === '‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï'
            );
            
            tbody.innerHTML = filteredLog.map((log, index) => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="px-4 py-2">${log.date}</td>
                    <td class="px-4 py-2">${log.time}</td>
                    <td class="px-4 py-2">${log.user}</td>
                    <td class="px-4 py-2">${log.action}</td>
                    <td class="px-4 py-2">${log.detail}</td>
                    <td class="px-4 py-2 text-center">
                        ${log.status === '‡∏£‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô' ? 
                            `<button onclick="acknowledgeActivity(${index})" class="bg-orange-500 text-white px-3 py-1 rounded text-sm hover:bg-orange-600">‡∏£‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>` :
                            `<span class="bg-green-100 text-green-800 px-3 py-1 rounded text-sm">‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö</span>`
                        }
                    </td>
                </tr>
            `).join('');
        }

        // Modal functions
        function showModal(content) {
            document.getElementById('modalContent').innerHTML = content;
            document.getElementById('modalOverlay').classList.remove('hidden');
        }

        function hideModal() {
            document.getElementById('modalOverlay').classList.add('hidden');
        }

        // Click outside modal to close
        document.getElementById('modalOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                hideModal();
            }
        });

        // Officer training history modal
        function showOfficerTrainingHistory(officerId) {
            const officer = officers.find(o => o.id === officerId);
            const training = trainingData[officerId] || {};
            
            let totalCourses = 0;
            let trainingHistory = [];
            
            Object.keys(training).forEach(year => {
                const courses = training[year];
                if (courses && courses.length > 0) {
                    totalCourses += courses.length;
                    trainingHistory.push(`‡∏õ‡∏µ ${year} (${courses.join(', ')})`);
                }
            });
            
            const historyText = trainingHistory.length > 0 ? trainingHistory.join(', ') : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°';
            
            const content = `
                <h3 class="text-lg font-bold text-dark-green mb-4">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°</h3>
                <p class="mb-4"><strong>‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:</strong> ${officer.name}</p>
                <div class="mb-4 p-4 bg-gray-50 rounded">
                    <p class="text-sm text-gray-700 mb-2">‡∏ó‡πà‡∏≤‡∏ô‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏ö‡∏£‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <strong>${totalCourses}</strong> ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                    <p class="text-sm text-gray-700">${historyText}</p>
                </div>
                <div class="flex justify-end">
                    <button onclick="hideModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400">‡∏õ‡∏¥‡∏î</button>
                </div>
            `;
            showModal(content);
        }

        // Training modal
        function showTrainingModal(officerId, year) {
            const officer = officers.find(o => o.id === officerId);
            const courses = trainingData[officerId]?.[year] || [];
            
            const content = `
                <h3 class="text-lg font-bold text-dark-green mb-4">‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°‡∏õ‡∏µ ${year}</h3>
                <p class="mb-4"><strong>‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:</strong> ${officer.name}</p>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏ö‡∏£‡∏°</label>
                    <textarea id="trainingCourses" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" rows="4" placeholder="‡πÉ‡∏™‡πà‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏ö‡∏£‡∏° (‡πÅ‡∏¢‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà)">${courses.join('\n')}</textarea>
                </div>
                <div class="flex justify-end space-x-2">
                    <button onclick="hideModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button onclick="saveTraining('${officerId}', '${year}')" class="px-4 py-2 bg-medium-green text-white rounded hover:bg-dark-green">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>
            `;
            showModal(content);
        }

        async function saveTraining(officerId, year) {
            const courses = document.getElementById('trainingCourses').value.split('\n').filter(course => course.trim() !== '');
            
            try {
                // Get old value for logging
                const oldCourses = trainingData[officerId]?.[year] || [];
                const oldValue = oldCourses.length > 0 ? oldCourses.join(', ') : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
                const newValue = courses.length > 0 ? courses.join(', ') : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
                
                if (!trainingData[officerId]) {
                    trainingData[officerId] = {};
                }
                trainingData[officerId][year] = courses;
                
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Firebase
                await saveToFirebase('trainingData', trainingData);
                
                await logActivity('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç', `‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏° ${officerId} ‡∏õ‡∏µ ${year}`, oldValue, newValue);
                hideModal();
                loadTrainingData();
                
            } catch (error) {
                console.error('Error saving training data:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
            }
        }

        // Save functions
        async function saveOrgInfo() {
            const phone = document.getElementById('editPhone').value;
            const fax = document.getElementById('editFax').value;
            const email = document.getElementById('editEmail').value;
            
            try {
                // Find current organization
                const userOrg = organizations.find(org => org.id === currentUser.orgId);
                
                // Log changes for each field that was modified
                if (userOrg) {
                    if (phone !== userOrg.phone) {
                        await logActivity('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç', `‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô ${userOrg.id}`, userOrg.phone, phone);
                        userOrg.phone = phone;
                    }
                    if (fax !== userOrg.fax) {
                        await logActivity('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç', `‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏ó‡∏£‡∏™‡∏≤‡∏£‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô ${userOrg.id}`, userOrg.fax, fax);
                        userOrg.fax = fax;
                    }
                    if (email !== userOrg.email) {
                        await logActivity('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç', `‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô ${userOrg.id}`, userOrg.email, email);
                        userOrg.email = email;
                    }
                    
                    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Firebase
                    await saveToFirebase('organizations', organizations);
                }
                
                alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                
            } catch (error) {
                console.error('Error saving organization info:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
            }
        }

        // Log activity
        async function logActivity(action, detail, oldValue = null, newValue = null) {
            // Only log add, edit, delete, confirm, reset actions
            if (action === '‡πÄ‡∏û‡∏¥‡πà‡∏°' || action === '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç' || action === '‡∏•‡∏ö' || action === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô' || action === '‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï') {
                const now = new Date();
                const date = now.toISOString().split('T')[0];
                const time = now.toTimeString().split(' ')[0].substring(0, 5);
                
                let formattedDetail = detail;
                
                // For edit actions, format with old and new values
                if (action === '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç' && oldValue !== null && newValue !== null) {
                    formattedDetail = `${detail} | ‡πÄ‡∏î‡∏¥‡∏°: ${oldValue} | ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô: ${newValue}`;
                }
                
                const logEntry = {
                    date: date,
                    time: time,
                    user: currentUser ? currentUser.username : 'system',
                    action: action,
                    detail: formattedDetail,
                    status: '‡∏£‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô'
                };
                
                activityLog.unshift(logEntry);
                
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Firebase
                try {
                    await saveToFirebase('activityLog', activityLog);
                } catch (error) {
                    console.error('Error saving activity log:', error);
                }
            }
        }

        // Acknowledge activity function
        function acknowledgeActivity(index) {
            const filteredLog = activityLog.filter(log => 
                log.action === '‡πÄ‡∏û‡∏¥‡πà‡∏°' || log.action === '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç' || log.action === '‡∏•‡∏ö' || log.action === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô' || log.action === '‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï'
            );
            
            if (filteredLog[index] && filteredLog[index].status === '‡∏£‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô') {
                // Find the original log entry and update it
                const originalIndex = activityLog.findIndex(log => 
                    log.date === filteredLog[index].date && 
                    log.time === filteredLog[index].time && 
                    log.detail === filteredLog[index].detail
                );
                
                if (originalIndex !== -1) {
                    activityLog[originalIndex].status = '‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö';
                    loadActivityLogData(); // Refresh the table
                }
            }
        }

        // Search and filter functions
        function searchOfficers() {
            filterOfficers();
        }
        
        function filterOfficers() {
            const searchTerm = document.getElementById('officerSearch')?.value.toLowerCase() || '';
            const orgFilter = document.getElementById('orgFilter')?.value || '';
            const trainingFilter = document.getElementById('trainingFilter')?.value || '';
            
            const orgBlocks = document.querySelectorAll('#officerDashboard .mb-8');
            
            orgBlocks.forEach(block => {
                const rows = block.querySelectorAll('tbody tr');
                let hasVisibleRows = false;
                
                rows.forEach(row => {
                    const officerId = row.cells[0]?.textContent || '';
                    const officerName = row.cells[1]?.textContent || '';
                    const orgName = row.cells[2]?.textContent || '';
                    
                    // Get officer data for training filter
                    const officer = officers.find(o => o.id === officerId);
                    let hasTraining = false;
                    if (officer && trainingData[officer.id]) {
                        hasTraining = Object.values(trainingData[officer.id]).some(courses => courses && courses.length > 0);
                    }
                    
                    // Apply filters
                    let showRow = true;
                    
                    // Search filter
                    if (searchTerm) {
                        const searchText = `${officerId} ${officerName} ${orgName}`.toLowerCase();
                        if (!searchText.includes(searchTerm)) {
                            showRow = false;
                        }
                    }
                    
                    // Organization filter
                    if (orgFilter && officer && officer.orgId !== orgFilter) {
                        showRow = false;
                    }
                    
                    // Training status filter
                    if (trainingFilter) {
                        if (trainingFilter === 'trained' && !hasTraining) {
                            showRow = false;
                        } else if (trainingFilter === 'not-trained' && hasTraining) {
                            showRow = false;
                        }
                    }
                    
                    row.style.display = showRow ? '' : 'none';
                    if (showRow) hasVisibleRows = true;
                });
                
                // Hide/show entire organization block if no visible rows
                block.style.display = hasVisibleRows ? '' : 'none';
            });
        }
        
        // Confirmation functions
        function updateConfirmationStatusDisplay() {
            const userOrg = currentUser.orgId;
            const status = confirmationStatus[userOrg];
            
            // Update team confirmation status
            const teamStatusEl = document.getElementById('teamConfirmStatus');
            const orgStatusEl = document.getElementById('orgConfirmStatus');
            const confirmBtn = document.getElementById('confirmTeamDataBtn');
            
            if (teamStatusEl) {
                if (status.teamConfirmed) {
                    teamStatusEl.textContent = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß';
                    teamStatusEl.className = 'inline-block px-3 py-1 rounded text-sm font-medium bg-green-100 text-green-800';
                } else {
                    teamStatusEl.textContent = '‡∏£‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô';
                    teamStatusEl.className = 'inline-block px-3 py-1 rounded text-sm font-medium bg-gray-100 text-gray-600';
                }
            }
            
            if (orgStatusEl) {
                if (status.orgConfirmed) {
                    orgStatusEl.textContent = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß';
                    orgStatusEl.className = 'inline-block px-3 py-1 rounded text-sm font-medium bg-green-100 text-green-800';
                } else {
                    orgStatusEl.textContent = '‡∏£‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô';
                    orgStatusEl.className = 'inline-block px-3 py-1 rounded text-sm font-medium bg-gray-100 text-gray-600';
                }
            }
            
            // Update button state
            if (confirmBtn) {
                if (status.teamConfirmed && status.orgConfirmed) {
                    confirmBtn.textContent = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß';
                    confirmBtn.disabled = true;
                    confirmBtn.className = 'bg-gray-400 text-white px-6 py-2 rounded cursor-not-allowed';
                } else {
                    confirmBtn.textContent = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
                    confirmBtn.disabled = false;
                    confirmBtn.className = 'bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700';
                }
            }
        }
        
        function confirmTeamData() {
            const userOrg = currentUser.orgId;
            
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏°‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                confirmationStatus[userOrg].teamConfirmed = true;
                confirmationStatus[userOrg].orgConfirmed = true;
                
                logActivity('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô', `‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏°‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô ${userOrg}`);
                updateConfirmationStatusDisplay();
                
                alert('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö');
            }
        }
        
        function resetTeamConfirmation(orgId) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                confirmationStatus[orgId].teamConfirmed = false;
                logActivity('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï', `‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏° ${orgId}`);
                loadAllOfficersData();
                alert('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
            }
        }
        
        function resetOrgConfirmation(orgId) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                confirmationStatus[orgId].orgConfirmed = false;
                logActivity('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï', `‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô ${orgId}`);
                loadOrganizationsData();
                alert('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
            }
        }
        
        // Confirmation functions
        function updateConfirmationStatusDisplay() {
            const userOrg = currentUser.orgId;
            const status = confirmationStatus[userOrg];
            
            // Update team confirmation status
            const teamStatusEl = document.getElementById('teamConfirmStatus');
            const orgStatusEl = document.getElementById('orgConfirmStatus');
            const confirmBtn = document.getElementById('confirmTeamDataBtn');
            
            if (teamStatusEl) {
                if (status.teamConfirmed) {
                    teamStatusEl.textContent = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß';
                    teamStatusEl.className = 'inline-block px-3 py-1 rounded text-sm font-medium bg-green-100 text-green-800';
                } else {
                    teamStatusEl.textContent = '‡∏£‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô';
                    teamStatusEl.className = 'inline-block px-3 py-1 rounded text-sm font-medium bg-gray-100 text-gray-600';
                }
            }
            
            if (orgStatusEl) {
                if (status.orgConfirmed) {
                    orgStatusEl.textContent = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß';
                    orgStatusEl.className = 'inline-block px-3 py-1 rounded text-sm font-medium bg-green-100 text-green-800';
                } else {
                    orgStatusEl.textContent = '‡∏£‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô';
                    orgStatusEl.className = 'inline-block px-3 py-1 rounded text-sm font-medium bg-gray-100 text-gray-600';
                }
            }
            
            // Update button state
            if (confirmBtn) {
                if (status.teamConfirmed && status.orgConfirmed) {
                    confirmBtn.textContent = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß';
                    confirmBtn.disabled = true;
                    confirmBtn.className = 'bg-gray-400 text-white px-6 py-2 rounded cursor-not-allowed';
                } else {
                    confirmBtn.textContent = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
                    confirmBtn.disabled = false;
                    confirmBtn.className = 'bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700';
                }
            }
        }
        
        function confirmTeamData() {
            const userOrg = currentUser.orgId;
            
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏°‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                confirmationStatus[userOrg].teamConfirmed = true;
                confirmationStatus[userOrg].orgConfirmed = true;
                
                logActivity('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô', `‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏°‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô ${userOrg}`);
                updateConfirmationStatusDisplay();
                
                alert('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö');
            }
        }
        
        function resetTeamConfirmation(orgId) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                confirmationStatus[orgId].teamConfirmed = false;
                logActivity('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï', `‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏° ${orgId}`);
                loadAllOfficersData();
                alert('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
            }
        }
        
        function resetOrgConfirmation(orgId) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                confirmationStatus[orgId].orgConfirmed = false;
                logActivity('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï', `‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô ${orgId}`);
                loadOrganizationsData();
                alert('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
            }
        }
        
        // Modal functions for adding new records
        function showAddMemberModal() {
            const content = `
                <h3 class="text-lg font-bold text-dark-green mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏ó‡∏µ‡∏°</h3>
                <form id="addMemberForm">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</label>
                            <input type="text" id="memberOfficerId" placeholder="‡πÄ‡∏ä‡πà‡∏ô OFF001" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                            <input type="text" id="memberName" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                            <input type="tel" id="memberPhone" placeholder="081-234-5678" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                            <input type="email" id="memberEmail" placeholder="example@bma.go.th" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-2 mt-6">
                        <button type="button" onclick="hideModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        <button type="submit" class="px-4 py-2 bg-medium-green text-white rounded hover:bg-dark-green">‡πÄ‡∏û‡∏¥‡πà‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
                    </div>
                </form>
            `;
            showModal(content);
            
            // Add form submit handler
            document.getElementById('addMemberForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                await addNewMember();
            });
        }
        
        async function addNewMember() {
            try {
                const officerId = document.getElementById('memberOfficerId').value.trim().toUpperCase();
                const name = document.getElementById('memberName').value.trim();
                const phone = document.getElementById('memberPhone').value.trim();
                const email = document.getElementById('memberEmail').value.trim();
                
                // Validation
                if (!officerId || !name || !phone || !email) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                    return;
                }
                
                // Check if officer ID already exists
                const existingOfficer = officers.find(o => o.id === officerId);
                if (existingOfficer) {
                    alert('‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß');
                    return;
                }
                
                const newOfficer = {
                    id: officerId,
                    name: name,
                    phone: phone,
                    email: email,
                    orgId: currentUser.orgId,
                    createdAt: new Date().toISOString()
                };
                
                // Add to local array
                officers.push(newOfficer);
                
                // Save to Firebase
                const officerRef = window.firebasePush(window.firebaseRef(window.firebaseDatabase, 'officers'));
                await window.firebaseSet(officerRef, newOfficer);
                
                // Initialize training data for new officer
                if (!trainingData[officerId]) {
                    trainingData[officerId] = {};
                    await saveToFirebase('trainingData', trainingData);
                }
                
                await logActivity('‡πÄ‡∏û‡∏¥‡πà‡∏°', `‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà: ${name} (${officerId})`);
                
                hideModal();
                loadTeamData(); // Refresh team data
                alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                
            } catch (error) {
                console.error('Error adding member:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å');
            }
        }
        
        // Import officers from Excel function
        function showImportOfficersModal() {
            const content = `
                <h3 class="text-lg font-bold text-dark-green mb-4">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel</h3>
                <div class="space-y-4">
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-medium text-yellow-800">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå Excel ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£:</h4>
                            <button onclick="downloadExcelTemplate()" class="bg-yellow-600 text-white px-3 py-1 rounded text-sm hover:bg-yellow-700">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Template</button>
                        </div>
                        <ul class="text-sm text-yellow-700 space-y-1">
                            <li>‚Ä¢ ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå A: ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà (‡πÄ‡∏ä‡πà‡∏ô OFF001)</li>
                            <li>‚Ä¢ ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå B: ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</li>
                            <li>‚Ä¢ ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå C: ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</li>
                            <li>‚Ä¢ ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå D: ‡∏≠‡∏µ‡πÄ‡∏°‡∏•</li>
                            <li>‚Ä¢ ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå E: ‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ORG001)</li>
                            <li>‚Ä¢ ‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡∏à‡∏∞‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ)</li>
                        </ul>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel</label>
                        <input type="file" id="excelFile" accept=".xlsx,.xls" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green">
                    </div>
                    <div id="importPreview" class="hidden">
                        <h4 class="font-medium text-gray-800 mb-2">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤:</h4>
                        <div class="max-h-60 overflow-y-auto border border-gray-200 rounded">
                            <table class="min-w-full text-sm">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-2 py-1 text-left">‡∏£‡∏´‡∏±‡∏™</th>
                                        <th class="px-2 py-1 text-left">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                        <th class="px-2 py-1 text-left">‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</th>
                                        <th class="px-2 py-1 text-left">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                                        <th class="px-2 py-1 text-left">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th>
                                    </tr>
                                </thead>
                                <tbody id="previewTableBody">
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-2 text-sm text-gray-600">
                            <span id="previewCount"></span>
                        </div>
                    </div>
                    <div id="importErrors" class="hidden bg-red-50 border border-red-200 rounded-lg p-4">
                        <h4 class="font-medium text-red-800 mb-2">‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏û‡∏ö:</h4>
                        <ul id="errorList" class="text-sm text-red-700 space-y-1">
                        </ul>
                    </div>
                </div>
                <div class="flex justify-end space-x-2 mt-6">
                    <button type="button" onclick="hideModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="button" id="previewBtn" onclick="previewImport()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700" disabled>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    <button type="button" id="importBtn" onclick="importOfficers()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700" disabled>‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </div>
            `;
            showModal(content);
            
            // Add file change listener
            document.getElementById('excelFile').addEventListener('change', function(e) {
                const file = e.target.files[0];
                const previewBtn = document.getElementById('previewBtn');
                if (file) {
                    previewBtn.disabled = false;
                } else {
                    previewBtn.disabled = true;
                    document.getElementById('importBtn').disabled = true;
                    document.getElementById('importPreview').classList.add('hidden');
                    document.getElementById('importErrors').classList.add('hidden');
                }
            });
        }
        
        let importData = [];
        
        function previewImport() {
            console.log('Starting previewImport function');
            const fileInput = document.getElementById('excelFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel');
                return;
            }
            
            console.log('File selected:', file.name, file.type, file.size);
            
            // Check if XLSX library is loaded
            if (typeof XLSX === 'undefined') {
                alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡πà‡∏≤‡∏ô Excel ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤');
                console.error('XLSX library not loaded');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                console.log('File read successfully');
                try {
                    const data = new Uint8Array(e.target.result);
                    console.log('Data length:', data.length);
                    
                    const workbook = XLSX.read(data, { type: 'array' });
                    console.log('Workbook sheets:', workbook.SheetNames);
                    
                    if (workbook.SheetNames.length === 0) {
                        alert('‡πÑ‡∏°‡πà‡∏û‡∏ö sheet ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå Excel');
                        return;
                    }
                    
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    console.log('Raw JSON data:', jsonData);
                    
                    // Skip header row and process data
                    const dataRows = jsonData.slice(1).filter(row => {
                        return row && row.length > 0 && row[0] != null && row[0] !== ''; // At least officer ID must exist
                    });
                    
                    console.log('Filtered data rows:', dataRows.length);
                    
                    if (dataRows.length === 0) {
                        alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå Excel ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå');
                        return;
                    }
                    
                    importData = [];
                    const errors = [];
                    const existingIds = new Set(officers.map(o => o.id));
                    const orgIds = new Set(organizations.map(org => org.id));
                    
                    console.log('Existing officer IDs:', Array.from(existingIds));
                    console.log('Existing org IDs:', Array.from(orgIds));
                    
                    dataRows.forEach((row, index) => {
                        const rowNum = index + 2; // +2 because we skipped header and arrays are 0-indexed
                        console.log(`Processing row ${rowNum}:`, row);
                        
                        const [officerId, name, phone, email, orgId] = row;
                        
                        // Validation
                        const rowErrors = [];
                        
                        // Convert values to strings and handle empty cells
                        const cleanOfficerId = officerId ? String(officerId).trim() : '';
                        const cleanName = name ? String(name).trim() : '';
                        const cleanPhone = phone ? String(phone).trim() : '';
                        const cleanEmail = email ? String(email).trim() : '';
                        const cleanOrgId = orgId ? String(orgId).trim() : '';
                        
                        if (!cleanOfficerId) {
                            rowErrors.push(`‡πÅ‡∏ñ‡∏ß ${rowNum}: ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á`);
                        } else {
                            const upperOfficerId = cleanOfficerId.toUpperCase();
                            if (existingIds.has(upperOfficerId)) {
                                rowErrors.push(`‡πÅ‡∏ñ‡∏ß ${rowNum}: ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà ${upperOfficerId} ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö`);
                            }
                        }
                        
                        if (!cleanName) {
                            rowErrors.push(`‡πÅ‡∏ñ‡∏ß ${rowNum}: ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á`);
                        }
                        
                        if (!cleanPhone) {
                            rowErrors.push(`‡πÅ‡∏ñ‡∏ß ${rowNum}: ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á`);
                        }
                        
                        if (!cleanEmail || !cleanEmail.includes('@')) {
                            rowErrors.push(`‡πÅ‡∏ñ‡∏ß ${rowNum}: ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á`);
                        }
                        
                        if (!cleanOrgId) {
                            rowErrors.push(`‡πÅ‡∏ñ‡∏ß ${rowNum}: ‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á`);
                        } else {
                            const upperOrgId = cleanOrgId.toUpperCase();
                            if (!orgIds.has(upperOrgId)) {
                                rowErrors.push(`‡πÅ‡∏ñ‡∏ß ${rowNum}: ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô ${upperOrgId} ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö`);
                            }
                        }
                        
                        if (rowErrors.length > 0) {
                            errors.push(...rowErrors);
                        } else {
                            importData.push({
                                id: cleanOfficerId.toUpperCase(),
                                name: cleanName,
                                phone: cleanPhone,
                                email: cleanEmail,
                                orgId: cleanOrgId.toUpperCase(),
                                createdAt: new Date().toISOString()
                            });
                        }
                    });
                    
                    console.log('Import data created:', importData.length, 'items');
                    console.log('Errors found:', errors.length);
                    
                    // Show preview
                    console.log('Showing preview for', importData.length, 'items');
                    const previewDiv = document.getElementById('importPreview');
                    const previewTableBody = document.getElementById('previewTableBody');
                    const previewCount = document.getElementById('previewCount');
                    
                    if (!previewDiv || !previewTableBody || !previewCount) {
                        console.error('Preview elements not found');
                        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á');
                        return;
                    }
                    
                    previewTableBody.innerHTML = '';
                    importData.forEach((officer, index) => {
                        console.log(`Creating preview row ${index + 1}:`, officer);
                        const org = organizations.find(o => o.id === officer.orgId);
                        const row = document.createElement('tr');
                        row.className = 'border-b';
                        row.innerHTML = `
                            <td class="px-2 py-1">${officer.id}</td>
                            <td class="px-2 py-1">${officer.name}</td>
                            <td class="px-2 py-1">${officer.phone}</td>
                            <td class="px-2 py-1">${officer.email}</td>
                            <td class="px-2 py-1">${org ? org.name : officer.orgId}</td>
                        `;
                        previewTableBody.appendChild(row);
                    });
                    
                    previewCount.textContent = `‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ${importData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
                    console.log('Making preview visible');
                    previewDiv.classList.remove('hidden');
                    
                    // Show errors if any
                    const errorsDiv = document.getElementById('importErrors');
                    const errorList = document.getElementById('errorList');
                    
                    if (errors.length > 0) {
                        errorList.innerHTML = '';
                        errors.forEach(error => {
                            const li = document.createElement('li');
                            li.textContent = `‚Ä¢ ${error}`;
                            errorList.appendChild(li);
                        });
                        errorsDiv.classList.remove('hidden');
                    } else {
                        errorsDiv.classList.add('hidden');
                    }
                    
                    // Enable import button if there's valid data
                    document.getElementById('importBtn').disabled = importData.length === 0;
                    
                } catch (error) {
                    console.error('Error reading Excel file:', error);
                    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå Excel: ' + error.message);
                }
            };
            
            reader.onerror = function(error) {
                console.error('FileReader error:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå');
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        function downloadExcelTemplate() {
            try {
                // Create sample data for template
                const templateData = [
                    ['‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà', '‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•', '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå', '‡∏≠‡∏µ‡πÄ‡∏°‡∏•', '‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô'],
                    ['OFF001', '‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ', '081-234-5678', 'somchai@bma.go.th', 'ORG001'],
                    ['OFF002', '‡∏ô‡∏≤‡∏á‡∏™‡∏°‡πÉ‡∏™ ‡∏™‡∏∏‡∏Ç‡πÉ‡∏à', '082-345-6789', 'somsai@bma.go.th', 'ORG002'],
                    ['OFF003', '‡∏ô‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏±‡∏¢ ‡πÄ‡∏Å‡πà‡∏á‡∏î‡∏µ', '083-456-7890', 'wichai@bma.go.th', 'ORG001']
                ];
                
                // Add available organizations as reference
                if (organizations.length > 0) {
                    templateData.push([]);
                    templateData.push(['‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö:']);
                    organizations.forEach(org => {
                        templateData.push([org.id, org.name]);
                    });
                }
                
                // Create workbook and worksheet
                const workbook = XLSX.utils.book_new();
                const worksheet = XLSX.utils.aoa_to_sheet(templateData);
                
                // Style the header row
                const range = XLSX.utils.decode_range(worksheet['!ref']);
                for (let col = range.s.c; col <= range.e.c; col++) {
                    const cellAddress = XLSX.utils.encode_cell({ r: 0, c: col });
                    if (!worksheet[cellAddress]) continue;
                    worksheet[cellAddress].s = {
                        font: { bold: true },
                        fill: { fgColor: { rgb: "FFFFAA" } }
                    };
                }
                
                // Set column widths
                worksheet['!cols'] = [
                    { width: 15 }, // ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà
                    { width: 25 }, // ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•
                    { width: 15 }, // ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå
                    { width: 30 }, // ‡∏≠‡∏µ‡πÄ‡∏°‡∏•
                    { width: 15 }  // ‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
                ];
                
                XLSX.utils.book_append_sheet(workbook, worksheet, 'Officers Template');
                
                // Generate and download file
                const filename = 'SRRT_Officers_Template_' + new Date().toISOString().slice(0, 10) + '.xlsx';
                XLSX.writeFile(workbook, filename);
                
                console.log('Template downloaded:', filename);
                
            } catch (error) {
                console.error('Error creating template:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á template');
            }
        }
        
        async function importOfficers() {
            if (importData.length === 0) {
                alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤');
                return;
            }
            
            if (!confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà ${importData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                return;
            }
            
            try {
                const importBtn = document.getElementById('importBtn');
                importBtn.disabled = true;
                importBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤...';
                
                let successCount = 0;
                let failCount = 0;
                
                for (const officer of importData) {
                    try {
                        // Add to local array
                        officers.push(officer);
                        
                        // Save to Firebase
                        const officerRef = window.firebasePush(window.firebaseRef(window.firebaseDatabase, 'officers'));
                        await window.firebaseSet(officerRef, officer);
                        
                        // Initialize training data for new officer
                        if (!trainingData[officer.id]) {
                            trainingData[officer.id] = {};
                        }
                        
                        // Initialize confirmation status for organization if needed
                        if (!confirmationStatus[officer.orgId]) {
                            confirmationStatus[officer.orgId] = { teamConfirmed: false, orgConfirmed: false };
                        }
                        
                        successCount++;
                    } catch (error) {
                        console.error(`Error importing officer ${officer.id}:`, error);
                        failCount++;
                    }
                }
                
                // Save updated training data and confirmation status
                await saveToFirebase('trainingData', trainingData);
                await saveToFirebase('confirmationStatus', confirmationStatus);
                
                await logActivity('‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤', `‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å Excel: ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${successCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£${failCount > 0 ? `, ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${failCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£` : ''}`);
                
                hideModal();
                loadAllOfficersData(); // Refresh officers data
                
                if (failCount === 0) {
                    alert(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ${successCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
                } else {
                    alert(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${successCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${failCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
                }
                
            } catch (error) {
                console.error('Error importing officers:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
            }
        }
        
        function showAddOfficerModal() {
            const content = `
                <h3 class="text-lg font-bold text-dark-green mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏°‡πà</h3>
                <form id="addOfficerForm">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</label>
                            <input type="text" id="officerId" placeholder="‡πÄ‡∏ä‡πà‡∏ô OFF001" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                            <input type="text" id="officerName" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                            <input type="tel" id="officerPhone" placeholder="081-234-5678" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                            <input type="email" id="officerEmail" placeholder="example@bma.go.th" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</label>
                            <select id="officerOrgId" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-2 mt-6">
                        <button type="button" onclick="hideModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        <button type="submit" class="px-4 py-2 bg-medium-green text-white rounded hover:bg-dark-green">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</button>
                    </div>
                </form>
            `;
            showModal(content);
            
            // Populate organization dropdown
            const orgSelect = document.getElementById('officerOrgId');
            organizations.forEach(org => {
                const option = document.createElement('option');
                option.value = org.id;
                option.textContent = org.name;
                orgSelect.appendChild(option);
            });
            
            // Add form submit handler
            document.getElementById('addOfficerForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                await addNewOfficer();
            });
        }
        
        async function addNewOfficer() {
            try {
                const officerId = document.getElementById('officerId').value.trim().toUpperCase();
                const name = document.getElementById('officerName').value.trim();
                const phone = document.getElementById('officerPhone').value.trim();
                const email = document.getElementById('officerEmail').value.trim();
                const orgId = document.getElementById('officerOrgId').value;
                
                // Validation
                if (!officerId || !name || !phone || !email || !orgId) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                    return;
                }
                
                // Check if officer ID already exists
                const existingOfficer = officers.find(o => o.id === officerId);
                if (existingOfficer) {
                    alert('‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß');
                    return;
                }
                
                const newOfficer = {
                    id: officerId,
                    name: name,
                    phone: phone,
                    email: email,
                    orgId: orgId,
                    createdAt: new Date().toISOString()
                };
                
                // Add to local array
                officers.push(newOfficer);
                
                // Save to Firebase
                const officerRef = window.firebasePush(window.firebaseRef(window.firebaseDatabase, 'officers'));
                await window.firebaseSet(officerRef, newOfficer);
                
                // Initialize training data for new officer
                if (!trainingData[officerId]) {
                    trainingData[officerId] = {};
                    await saveToFirebase('trainingData', trainingData);
                }
                
                // Initialize confirmation status for new organization if needed
                if (!confirmationStatus[orgId]) {
                    confirmationStatus[orgId] = { teamConfirmed: false, orgConfirmed: false };
                    await saveToFirebase('confirmationStatus', confirmationStatus);
                }
                
                await logActivity('‡πÄ‡∏û‡∏¥‡πà‡∏°', `‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏°‡πà: ${name} (${officerId})`);
                
                hideModal();
                loadAllOfficersData(); // Refresh officers data
                alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                
            } catch (error) {
                console.error('Error adding officer:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà');
            }
        }
        // Import organizations from Excel function
        function showImportOrganizationsModal() {
            const content = `
                <h3 class="text-lg font-bold text-dark-green mb-4">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel</h3>
                <div class="space-y-4">
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-medium text-yellow-800">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå Excel ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£:</h4>
                            <button onclick="downloadOrganizationTemplate()" class="bg-yellow-600 text-white px-3 py-1 rounded text-sm hover:bg-yellow-700">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Template</button>
                        </div>
                        <ul class="text-sm text-yellow-700 space-y-1">
                            <li>‚Ä¢ ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå A: ‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ORG001)</li>
                            <li>‚Ä¢ ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå B: ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</li>
                            <li>‚Ä¢ ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå C: ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</li>
                            <li>‚Ä¢ ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå D: ‡πÇ‡∏ó‡∏£‡∏™‡∏≤‡∏£</li>
                            <li>‚Ä¢ ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå E: ‡∏≠‡∏µ‡πÄ‡∏°‡∏•</li>
                            <li>‚Ä¢ ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå F: ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</li>
                            <li>‚Ä¢ ‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡∏à‡∏∞‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ)</li>
                        </ul>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel</label>
                        <input type="file" id="orgExcelFile" accept=".xlsx,.xls" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green">
                    </div>
                    <div id="orgImportPreview" class="hidden">
                        <h4 class="font-medium text-gray-800 mb-2">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤:</h4>
                        <div class="max-h-60 overflow-y-auto border border-gray-200 rounded">
                            <table class="min-w-full text-sm">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-2 py-1 text-left">‡∏£‡∏´‡∏±‡∏™</th>
                                        <th class="px-2 py-1 text-left">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th>
                                        <th class="px-2 py-1 text-left">‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</th>
                                        <th class="px-2 py-1 text-left">‡πÇ‡∏ó‡∏£‡∏™‡∏≤‡∏£</th>
                                        <th class="px-2 py-1 text-left">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                                        <th class="px-2 py-1 text-left">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</th>
                                    </tr>
                                </thead>
                                <tbody id="orgPreviewTableBody">
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-2 text-sm text-gray-600">
                            <span id="orgPreviewCount"></span>
                        </div>
                    </div>
                    <div id="orgImportErrors" class="hidden bg-red-50 border border-red-200 rounded-lg p-4">
                        <h4 class="font-medium text-red-800 mb-2">‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏û‡∏ö:</h4>
                        <ul id="orgErrorList" class="text-sm text-red-700 space-y-1">
                        </ul>
                    </div>
                </div>
                <div class="flex justify-end space-x-2 mt-6">
                    <button type="button" onclick="hideModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="button" id="orgPreviewBtn" onclick="previewOrganizationImport()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700" disabled>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    <button type="button" id="orgImportBtn" onclick="importOrganizations()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700" disabled>‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </div>
            `;
            showModal(content);
            
            // Add file change listener
            document.getElementById('orgExcelFile').addEventListener('change', function(e) {
                const file = e.target.files[0];
                const previewBtn = document.getElementById('orgPreviewBtn');
                if (file) {
                    previewBtn.disabled = false;
                } else {
                    previewBtn.disabled = true;
                    document.getElementById('orgImportBtn').disabled = true;
                    document.getElementById('orgImportPreview').classList.add('hidden');
                    document.getElementById('orgImportErrors').classList.add('hidden');
                }
            });
        }
        
        let orgImportData = [];
        
        function downloadOrganizationTemplate() {
            try {
                // Create sample data for template
                const templateData = [
                    ['‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô', '‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô', '‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå', '‡πÇ‡∏ó‡∏£‡∏™‡∏≤‡∏£', '‡∏≠‡∏µ‡πÄ‡∏°‡∏•', '‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà'],
                    ['ORG001', '‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏™‡∏∏‡∏Ç ‡πÄ‡∏Ç‡∏ï‡∏à‡∏ï‡∏∏‡∏à‡∏±‡∏Å‡∏£', '02-123-4567', '02-123-4568', 'health1@bma.go.th', '123 ‡∏ñ.‡∏£‡∏≤‡∏ä‡∏ß‡∏¥‡∏ñ‡∏µ ‡πÄ‡∏Ç‡∏ï‡∏à‡∏ï‡∏∏‡∏à‡∏±‡∏Å‡∏£'],
                    ['ORG002', '‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏™‡∏∏‡∏Ç ‡πÄ‡∏Ç‡∏ï‡∏î‡∏¥‡∏ô‡πÅ‡∏î‡∏á', '02-234-5678', '02-234-5679', 'health2@bma.go.th', '456 ‡∏ñ.‡∏î‡∏¥‡∏ô‡πÅ‡∏î‡∏á ‡πÄ‡∏Ç‡∏ï‡∏î‡∏¥‡∏ô‡πÅ‡∏î‡∏á'],
                    ['ORG003', '‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏™‡∏∏‡∏Ç ‡πÄ‡∏Ç‡∏ï‡∏ö‡∏≤‡∏á‡∏Å‡∏∞‡∏õ‡∏¥', '02-345-6789', '02-345-6790', 'health3@bma.go.th', '789 ‡∏ñ.‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå ‡πÄ‡∏Ç‡∏ï‡∏ö‡∏≤‡∏á‡∏Å‡∏∞‡∏õ‡∏¥']
                ];
                
                // Create workbook and worksheet
                const workbook = XLSX.utils.book_new();
                const worksheet = XLSX.utils.aoa_to_sheet(templateData);
                
                // Style the header row
                const range = XLSX.utils.decode_range(worksheet['!ref']);
                for (let col = range.s.c; col <= range.e.c; col++) {
                    const cellAddress = XLSX.utils.encode_cell({ r: 0, c: col });
                    if (!worksheet[cellAddress]) continue;
                    worksheet[cellAddress].s = {
                        font: { bold: true },
                        fill: { fgColor: { rgb: "FFFFAA" } }
                    };
                }
                
                // Set column widths
                worksheet['!cols'] = [
                    { width: 12 }, // ‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
                    { width: 35 }, // ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
                    { width: 15 }, // ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå
                    { width: 15 }, // ‡πÇ‡∏ó‡∏£‡∏™‡∏≤‡∏£
                    { width: 25 }, // ‡∏≠‡∏µ‡πÄ‡∏°‡∏•
                    { width: 40 }  // ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà
                ];
                
                XLSX.utils.book_append_sheet(workbook, worksheet, 'Organizations Template');
                
                // Generate and download file
                const filename = 'SRRT_Organizations_Template_' + new Date().toISOString().slice(0, 10) + '.xlsx';
                XLSX.writeFile(workbook, filename);
                
                console.log('Organization template downloaded:', filename);
                
            } catch (error) {
                console.error('Error creating organization template:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á template');
            }
        }
        
        function previewOrganizationImport() {
            console.log('Starting previewOrganizationImport function');
            const fileInput = document.getElementById('orgExcelFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel');
                return;
            }
            
            console.log('Organization file selected:', file.name, file.type, file.size);
            
            // Check if XLSX library is loaded
            if (typeof XLSX === 'undefined') {
                alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡πà‡∏≤‡∏ô Excel ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤');
                console.error('XLSX library not loaded');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                console.log('Organization file read successfully');
                try {
                    const data = new Uint8Array(e.target.result);
                    console.log('Data length:', data.length);
                    
                    const workbook = XLSX.read(data, { type: 'array' });
                    console.log('Workbook sheets:', workbook.SheetNames);
                    
                    if (workbook.SheetNames.length === 0) {
                        alert('‡πÑ‡∏°‡πà‡∏û‡∏ö sheet ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå Excel');
                        return;
                    }
                    
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    console.log('Raw JSON data:', jsonData);
                    
                    // Skip header row and process data
                    const dataRows = jsonData.slice(1).filter(row => {
                        return row && row.length > 0 && row[0] != null && row[0] !== ''; // At least org ID must exist
                    });
                    
                    console.log('Filtered organization data rows:', dataRows.length);
                    
                    if (dataRows.length === 0) {
                        alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå Excel ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå');
                        return;
                    }
                    
                    orgImportData = [];
                    const errors = [];
                    const existingOrgIds = new Set(organizations.map(o => o.id));
                    
                    console.log('Existing organization IDs:', Array.from(existingOrgIds));
                    
                    dataRows.forEach((row, index) => {
                        const rowNum = index + 2; // +2 because we skipped header and arrays are 0-indexed
                        console.log(`Processing organization row ${rowNum}:`, row);
                        
                        const [orgId, name, phone, fax, email, address] = row;
                        
                        // Validation
                        const rowErrors = [];
                        
                        // Convert values to strings and handle empty cells
                        const cleanOrgId = orgId ? String(orgId).trim() : '';
                        const cleanName = name ? String(name).trim() : '';
                        const cleanPhone = phone ? String(phone).trim() : '';
                        const cleanFax = fax ? String(fax).trim() : '';
                        const cleanEmail = email ? String(email).trim() : '';
                        const cleanAddress = address ? String(address).trim() : '';
                        
                        if (!cleanOrgId) {
                            rowErrors.push(`‡πÅ‡∏ñ‡∏ß ${rowNum}: ‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á`);
                        } else {
                            const upperOrgId = cleanOrgId.toUpperCase();
                            if (existingOrgIds.has(upperOrgId)) {
                                rowErrors.push(`‡πÅ‡∏ñ‡∏ß ${rowNum}: ‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô ${upperOrgId} ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö`);
                            }
                        }
                        
                        if (!cleanName) {
                            rowErrors.push(`‡πÅ‡∏ñ‡∏ß ${rowNum}: ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á`);
                        }
                        
                        if (cleanEmail && !cleanEmail.includes('@')) {
                            rowErrors.push(`‡πÅ‡∏ñ‡∏ß ${rowNum}: ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á`);
                        }
                        
                        if (rowErrors.length > 0) {
                            errors.push(...rowErrors);
                        } else {
                            orgImportData.push({
                                id: cleanOrgId.toUpperCase(),
                                name: cleanName,
                                phone: cleanPhone,
                                fax: cleanFax,
                                email: cleanEmail,
                                address: cleanAddress,
                                createdAt: new Date().toISOString()
                            });
                        }
                    });
                    
                    console.log('Organization import data created:', orgImportData.length, 'items');
                    console.log('Errors found:', errors.length);
                    
                    // Show preview
                    console.log('Showing organization preview for', orgImportData.length, 'items');
                    const previewDiv = document.getElementById('orgImportPreview');
                    const previewTableBody = document.getElementById('orgPreviewTableBody');
                    const previewCount = document.getElementById('orgPreviewCount');
                    
                    if (!previewDiv || !previewTableBody || !previewCount) {
                        console.error('Organization preview elements not found');
                        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á');
                        return;
                    }
                    
                    previewTableBody.innerHTML = '';
                    orgImportData.forEach((org, index) => {
                        console.log(`Creating organization preview row ${index + 1}:`, org);
                        const row = document.createElement('tr');
                        row.className = 'border-b';
                        row.innerHTML = `
                            <td class="px-2 py-1">${org.id}</td>
                            <td class="px-2 py-1">${org.name}</td>
                            <td class="px-2 py-1">${org.phone}</td>
                            <td class="px-2 py-1">${org.fax}</td>
                            <td class="px-2 py-1">${org.email}</td>
                            <td class="px-2 py-1">${org.address}</td>
                        `;
                        previewTableBody.appendChild(row);
                    });
                    
                    previewCount.textContent = `‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ${orgImportData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
                    console.log('Making organization preview visible');
                    previewDiv.classList.remove('hidden');
                    
                    // Show errors if any
                    const errorsDiv = document.getElementById('orgImportErrors');
                    const errorList = document.getElementById('orgErrorList');
                    
                    if (errors.length > 0) {
                        errorList.innerHTML = '';
                        errors.forEach(error => {
                            const li = document.createElement('li');
                            li.textContent = `‚Ä¢ ${error}`;
                            errorList.appendChild(li);
                        });
                        errorsDiv.classList.remove('hidden');
                    } else {
                        errorsDiv.classList.add('hidden');
                    }
                    
                    // Enable import button if there's valid data
                    document.getElementById('orgImportBtn').disabled = orgImportData.length === 0;
                    
                } catch (error) {
                    console.error('Error reading organization Excel file:', error);
                    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå Excel: ' + error.message);
                }
            };
            
            reader.onerror = function(error) {
                console.error('FileReader error:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå');
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        async function importOrganizations() {
            if (orgImportData.length === 0) {
                alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤');
                return;
            }
            
            if (!confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô ${orgImportData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                return;
            }
            
            try {
                const importBtn = document.getElementById('orgImportBtn');
                importBtn.disabled = true;
                importBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤...';
                
                let successCount = 0;
                let failCount = 0;
                
                for (const org of orgImportData) {
                    try {
                        // Add to local array
                        organizations.push(org);
                        
                        // Save to Firebase
                        const orgRef = window.firebasePush(window.firebaseRef(window.firebaseDatabase, 'organizations'));
                        await window.firebaseSet(orgRef, org);
                        
                        // Initialize confirmation status for new organization
                        if (!confirmationStatus[org.id]) {
                            confirmationStatus[org.id] = { teamConfirmed: false, orgConfirmed: false };
                        }
                        
                        successCount++;
                    } catch (error) {
                        console.error(`Error importing organization ${org.id}:`, error);
                        failCount++;
                    }
                }
                
                // Save updated confirmation status
                await saveToFirebase('confirmationStatus', confirmationStatus);
                
                await logActivity('‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤', `‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏à‡∏≤‡∏Å Excel: ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${successCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£${failCount > 0 ? `, ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${failCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£` : ''}`);
                
                hideModal();
                loadOrganizationsData(); // Refresh organizations data
                
                if (failCount === 0) {
                    alert(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ${successCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
                } else {
                    alert(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${successCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${failCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
                }
                
            } catch (error) {
                console.error('Error importing organizations:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
            }
        }
        
        // Other placeholder functions (to be implemented later)
        function showAddYearModal() { alert('‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà - ‡∏à‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï'); }
        function showAddOrgModal() { alert('‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà - ‡∏à‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï'); }
        function showAddUserModal() {
            const content = `
                <h3 class="text-lg font-bold text-dark-green mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h3>
                <form id="addUserForm">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label>
                            <input type="text" id="addUserUsername" placeholder="‡πÄ‡∏ä‡πà‡∏ô admin01, officer001" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                            <p class="text-xs text-gray-500 mt-1">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                            <input type="text" id="addUserName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                            <input type="password" id="addUserPassword" placeholder="‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                            <input type="password" id="addUserConfirmPassword" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label>
                            <select id="addUserRole" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
                                <option value="officer">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</option>
                                <option value="admin">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</label>
                            <select id="addUserOrgId" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-2 mt-6">
                        <button type="button" onclick="hideModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        <button type="submit" class="px-4 py-2 bg-medium-green text-white rounded hover:bg-dark-green">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</button>
                    </div>
                </form>
            `;
            showModal(content);
            
            // Populate organization dropdown
            const orgSelect = document.getElementById('addUserOrgId');
            organizations.forEach(org => {
                const option = document.createElement('option');
                option.value = org.id;
                option.textContent = org.name;
                orgSelect.appendChild(option);
            });
            
            document.getElementById('addUserForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                await addNewUser();
            });
        }
        
        async function addNewUser() {
            try {
                const username = document.getElementById('addUserUsername').value.trim();
                const name = document.getElementById('addUserName').value.trim();
                const password = document.getElementById('addUserPassword').value;
                const confirmPassword = document.getElementById('addUserConfirmPassword').value;
                const role = document.getElementById('addUserRole').value;
                const orgId = document.getElementById('addUserOrgId').value;
                
                // Validation
                if (!username || !name || !password || !confirmPassword || !role || !orgId) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                    return;
                }
                
                if (password.length < 6) {
                    alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£');
                    return;
                }
                
                if (password !== confirmPassword) {
                    alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô');
                    return;
                }
                
                // Check if username already exists
                const existingUser = users.find(u => u.username === username);
                if (existingUser) {
                    alert('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö');
                    return;
                }
                
                const newUser = {
                    username: username,
                    name: name,
                    password: password,
                    role: role,
                    orgId: orgId,
                    createdAt: new Date().toISOString()
                };
                
                // Add to local array
                users.push(newUser);
                
                // Save to Firebase
                const userRef = window.firebasePush(window.firebaseRef(window.firebaseDatabase, 'users'));
                await window.firebaseSet(userRef, newUser);
                
                const org = organizations.find(o => o.id === orgId);
                await logActivity('‡πÄ‡∏û‡∏¥‡πà‡∏°', `‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà: ${name} (${username}) - ${role === 'admin' ? '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö' : '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà'} - ${org ? org.name : orgId}`);
                
                hideModal();
                loadUserAccountsData(); // Refresh user accounts data
                alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                
            } catch (error) {
                console.error('Error adding user:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
            }
        }
        // Edit and Delete functions
        function editMember(id) {
            const officer = officers.find(o => o.id === id);
            if (!officer) {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà');
                return;
            }
            
            const content = `
                <h3 class="text-lg font-bold text-dark-green mb-4">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h3>
                <form id="editMemberForm">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</label>
                            <input type="text" id="editMemberOfficerId" value="${officer.id}" class="w-full px-3 py-2 border border-gray-300 rounded bg-gray-100" readonly>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                            <input type="text" id="editMemberName" value="${officer.name}" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                            <input type="tel" id="editMemberPhone" value="${officer.phone}" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                            <input type="email" id="editMemberEmail" value="${officer.email}" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</label>
                            <select id="editMemberOrgId" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-2 mt-6">
                        <button type="button" onclick="hideModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        <button type="submit" class="px-4 py-2 bg-medium-green text-white rounded hover:bg-dark-green">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    </div>
                </form>
            `;
            showModal(content);
            
            // Populate organization dropdown
            const orgSelect = document.getElementById('editMemberOrgId');
            organizations.forEach(org => {
                const option = document.createElement('option');
                option.value = org.id;
                option.textContent = org.name;
                if (org.id === officer.orgId) {
                    option.selected = true;
                }
                orgSelect.appendChild(option);
            });
            
            document.getElementById('editMemberForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                await updateMember(id);
            });
        }
        
        async function updateMember(id) {
            try {
                const name = document.getElementById('editMemberName').value.trim();
                const phone = document.getElementById('editMemberPhone').value.trim();
                const email = document.getElementById('editMemberEmail').value.trim();
                const orgId = document.getElementById('editMemberOrgId').value;
                
                if (!name || !phone || !email || !orgId) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                    return;
                }
                
                const officer = officers.find(o => o.id === id);
                if (officer) {
                    const oldOrg = organizations.find(o => o.id === officer.orgId);
                    const newOrg = organizations.find(o => o.id === orgId);
                    const oldData = `${officer.name}, ${officer.phone}, ${officer.email}, ${oldOrg ? oldOrg.name : officer.orgId}`;
                    
                    officer.name = name;
                    officer.phone = phone;
                    officer.email = email;
                    officer.orgId = orgId;
                    officer.updatedAt = new Date().toISOString();
                    
                    await saveToFirebase('officers', officers);
                    
                    // Initialize confirmation status for new organization if needed
                    if (!confirmationStatus[orgId]) {
                        confirmationStatus[orgId] = { teamConfirmed: false, orgConfirmed: false };
                        await saveToFirebase('confirmationStatus', confirmationStatus);
                    }
                    
                    const newData = `${name}, ${phone}, ${email}, ${newOrg ? newOrg.name : orgId}`;
                    await logActivity('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç', `‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ${id}`, oldData, newData);
                    
                    hideModal();
                    loadTeamData();
                    loadAllOfficersData(); // Refresh both views
                    alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                }
                
            } catch (error) {
                console.error('Error updating member:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡πÇ‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
            }
        }
        
        async function deleteMember(id) {
            if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                return;
            }
            
            try {
                const officer = officers.find(o => o.id === id);
                if (officer) {
                    // Remove from local array
                    const index = officers.findIndex(o => o.id === id);
                    officers.splice(index, 1);
                    
                    // Remove training data
                    if (trainingData[id]) {
                        delete trainingData[id];
                        await saveToFirebase('trainingData', trainingData);
                    }
                    
                    await saveToFirebase('officers', officers);
                    await logActivity('‡∏•‡∏ö', `‡∏•‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: ${officer.name} (${id})`);
                    
                    loadTeamData();
                    alert('‡∏•‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                }
                
            } catch (error) {
                console.error('Error deleting member:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å');
            }
        }
        
        function editOfficer(id) {
            editMember(id); // Use the same function as editMember
        }
        
        function deleteOfficer(id) {
            deleteMember(id); // Use the same function as deleteMember
        }
        // Organization management functions
        function editOrganization(id) {
            const organization = organizations.find(o => o.id === id);
            if (!organization) {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô');
                return;
            }
            
            const content = `
                <h3 class="text-lg font-bold text-dark-green mb-4">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</h3>
                <form id="editOrgForm">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</label>
                            <input type="text" id="editOrgId" value="${organization.id}" class="w-full px-3 py-2 border border-gray-300 rounded bg-gray-100" readonly>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</label>
                            <input type="text" id="editOrgName" value="${organization.name}" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                            <input type="tel" id="editOrgPhone" value="${organization.phone || ''}" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÇ‡∏ó‡∏£‡∏™‡∏≤‡∏£</label>
                            <input type="tel" id="editOrgFax" value="${organization.fax || ''}" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                            <input type="email" id="editOrgEmail" value="${organization.email || ''}" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label>
                            <textarea id="editOrgAddress" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green">${organization.address || ''}</textarea>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-2 mt-6">
                        <button type="button" onclick="hideModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        <button type="submit" class="px-4 py-2 bg-medium-green text-white rounded hover:bg-dark-green">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    </div>
                </form>
            `;
            showModal(content);
            
            document.getElementById('editOrgForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                await updateOrganization(id);
            });
        }
        
        async function updateOrganization(id) {
            try {
                const name = document.getElementById('editOrgName').value.trim();
                const phone = document.getElementById('editOrgPhone').value.trim();
                const fax = document.getElementById('editOrgFax').value.trim();
                const email = document.getElementById('editOrgEmail').value.trim();
                const address = document.getElementById('editOrgAddress').value.trim();
                
                if (!name) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô');
                    return;
                }
                
                if (email && !email.includes('@')) {
                    alert('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                    return;
                }
                
                const organization = organizations.find(o => o.id === id);
                if (organization) {
                    const oldData = `${organization.name}, ${organization.phone || ''}, ${organization.fax || ''}, ${organization.email || ''}, ${organization.address || ''}`;
                    
                    organization.name = name;
                    organization.phone = phone;
                    organization.fax = fax;
                    organization.email = email;
                    organization.address = address;
                    organization.updatedAt = new Date().toISOString();
                    
                    await saveToFirebase('organizations', organizations);
                    
                    const newData = `${name}, ${phone}, ${fax}, ${email}, ${address}`;
                    await logActivity('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç', `‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô ${id}`, oldData, newData);
                    
                    hideModal();
                    loadOrganizationsData();
                    loadTeamData(); // Refresh team data too in case organization name changed
                    loadAllOfficersData(); // Refresh officers data
                    alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                }
                
            } catch (error) {
                console.error('Error updating organization:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô');
            }
        }
        
        async function deleteOrganization(id) {
            if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? (‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà)')) {
                return;
            }
            
            // Check if any officers belong to this organization
            const officersInOrg = officers.filter(o => o.orgId === id);
            if (officersInOrg.length > 0) {
                alert(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏°‡∏µ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà ${officersInOrg.length} ‡∏Ñ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ`);
                return;
            }
            
            try {
                const organization = organizations.find(o => o.id === id);
                if (organization) {
                    // Remove from local array
                    const index = organizations.findIndex(o => o.id === id);
                    organizations.splice(index, 1);
                    
                    // Remove confirmation status
                    if (confirmationStatus[id]) {
                        delete confirmationStatus[id];
                        await saveToFirebase('confirmationStatus', confirmationStatus);
                    }
                    
                    await saveToFirebase('organizations', organizations);
                    await logActivity('‡∏•‡∏ö', `‡∏•‡∏ö‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô: ${organization.name} (${id})`);
                    
                    loadOrganizationsData();
                    alert('‡∏•‡∏ö‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                }
                
            } catch (error) {
                console.error('Error deleting organization:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô');
            }
        }
        
        // User management functions
        function editUser(username) {
            const user = users.find(u => u.username === username);
            if (!user) {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
                return;
            }
            
            const content = `
                <h3 class="text-lg font-bold text-dark-green mb-4">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
                <form id="editUserForm">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label>
                            <input type="text" id="editUserUsername" value="${user.username}" class="w-full px-3 py-2 border border-gray-300 rounded bg-gray-100" readonly>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                            <input type="text" id="editUserName" value="${user.name}" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                            <input type="password" id="editUserPassword" value="${user.password}" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label>
                            <select id="editUserRole" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                                <option value="officer" ${user.role === 'officer' ? 'selected' : ''}>‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</option>
                                <option value="admin" ${user.role === 'admin' ? 'selected' : ''}>‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</label>
                            <select id="editUserOrgId" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-medium-green" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-2 mt-6">
                        <button type="button" onclick="hideModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        <button type="submit" class="px-4 py-2 bg-medium-green text-white rounded hover:bg-dark-green">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    </div>
                </form>
            `;
            showModal(content);
            
            // Populate organization dropdown
            const orgSelect = document.getElementById('editUserOrgId');
            organizations.forEach(org => {
                const option = document.createElement('option');
                option.value = org.id;
                option.textContent = org.name;
                if (org.id === user.orgId) {
                    option.selected = true;
                }
                orgSelect.appendChild(option);
            });
            
            document.getElementById('editUserForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                await updateUser(username);
            });
        }
        
        async function updateUser(username) {
            try {
                const name = document.getElementById('editUserName').value.trim();
                const password = document.getElementById('editUserPassword').value;
                const role = document.getElementById('editUserRole').value;
                const orgId = document.getElementById('editUserOrgId').value;
                
                if (!name || !password || !role || !orgId) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                    return;
                }
                
                if (password.length < 6) {
                    alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£');
                    return;
                }
                
                const user = users.find(u => u.username === username);
                if (user) {
                    const oldOrg = organizations.find(o => o.id === user.orgId);
                    const newOrg = organizations.find(o => o.id === orgId);
                    const oldData = `${user.name}, ${user.role}, ${oldOrg ? oldOrg.name : user.orgId}`;
                    
                    user.name = name;
                    user.password = password;
                    user.role = role;
                    user.orgId = orgId;
                    user.updatedAt = new Date().toISOString();
                    
                    await saveToFirebase('users', users);
                    
                    const newData = `${name}, ${role}, ${newOrg ? newOrg.name : orgId}`;
                    await logActivity('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç', `‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ${username}`, oldData, newData);
                    
                    hideModal();
                    loadUserAccountsData();
                    alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                }
                
            } catch (error) {
                console.error('Error updating user:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
            }
        }
        
        async function deleteUser(username) {
            // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö admin ‡∏Ñ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
            const adminUsers = users.filter(u => u.role === 'admin');
            const userToDelete = users.find(u => u.username === username);
            
            if (userToDelete && userToDelete.role === 'admin' && adminUsers.length <= 1) {
                alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÑ‡∏î‡πâ');
                return;
            }
            
            // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
            if (currentUser && currentUser.username === username) {
                alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ');
                return;
            }
            
            if (!confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô "${username}" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\\n\\n‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ`)) {
                return;
            }
            
            try {
                const user = users.find(u => u.username === username);
                if (user) {
                    // Remove from local array
                    const index = users.findIndex(u => u.username === username);
                    users.splice(index, 1);
                    
                    await saveToFirebase('users', users);
                    await logActivity('‡∏•‡∏ö', `‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: ${user.name} (${username})`);
                    
                    loadUserAccountsData();
                    alert('‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                }
                
            } catch (error) {
                console.error('Error deleting user:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
            }
        }
        
        // Test Firebase connection
        async function testFirebaseConnection() {
            try {
                console.log('Testing Firebase connection...');
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Firebase services ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                if (!window.firebaseDatabase || !window.firebaseRef || !window.firebaseSet) {
                    throw new Error('Firebase services not available');
                }
                
                const testRef = window.firebaseRef(window.firebaseDatabase, 'connectionTest');
                await window.firebaseSet(testRef, { 
                    timestamp: Date.now(), 
                    message: 'Connection test successful',
                    userAgent: navigator.userAgent.substring(0, 50)
                });
                
                console.log('‚úÖ Firebase connection successful');
                return true;
            } catch (error) {
                console.error('‚ùå Firebase connection failed:', error);
                console.error('Error details:', {
                    message: error.message,
                    code: error.code,
                    stack: error.stack
                });
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô UI ‡πÅ‡∏ó‡∏ô alert
                showError(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase: ${error.message}`);
                return false;
            }
        }

        // Update connection status display
        function updateConnectionStatus(isConnected, message = '') {
            const statusEl = document.getElementById('connectionStatus');
            if (statusEl) {
                if (isConnected) {
                    statusEl.innerHTML = '<span class="text-green-600">‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</span>';
                } else {
                    statusEl.innerHTML = `<span class="text-red-600">‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase: ${message}</span>`;
                }
            }
        }

        // Initialize Firebase data when page loads
        window.addEventListener('load', async function() {
            // ‡∏£‡∏≠‡πÉ‡∏´‡πâ Firebase SDK ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            const connectionOk = await testFirebaseConnection();
            if (connectionOk) {
                updateConnectionStatus(true);
                await initializeFirebaseData();
            } else {
                updateConnectionStatus(false, '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9840a241618b45b3',t:'MTc1ODY5OTYyOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
